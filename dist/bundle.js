(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var i={},s=[],a=0;a<e.length;a++){var c=e[a],d=o.base?c[0]+o.base:c[0],l=i[d]||0,m="".concat(d," ").concat(l);i[d]=l+1;var p=t(m),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)n[p].references++,n[p].updater(h);else{var u=r(h,o);o.byIndex=a,n.splice(a,0,{identifier:m,updater:u,references:1})}s.push(m)}return s}function r(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var a=t(i[s]);n[a].references--}for(var c=o(e,r),d=0;d<i.length;d++){var l=t(i[d]);0===n[l].references&&(n[l].updater(),n.splice(l,1))}i=c}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},159:(e,n,t)=>{t.d(n,{A:()=>a});var o=t(601),r=t.n(o),i=t(314),s=t.n(i)()(r());s.push([e.id,'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n  line-height: 1.6;\n  color: #333;\n  background-color: #f4f4f4;\n}\n\n/* Skip Link */\n.skip-link {\n  position: absolute;\n  top: -100px;\n  left: 0;\n  background: #2c3e50;\n  color: white;\n  padding: 8px;\n  z-index: 9999;\n  text-decoration: none;\n  transition: top 0.3s;\n  border: none;\n  font-family: inherit;\n  font-size: 1rem;\n  cursor: pointer;\n}\n\n.skip-link:focus {\n  top: 0;\n  outline: none;\n}\n\n/* Navigation */\n.navbar {\n  background: #2c3e50;\n  color: white;\n  padding: 1rem 0;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.nav-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.nav-title {\n  font-size: 1.8rem;\n  font-weight: bold;\n  color: #ecf0f1;\n}\n\n.nav-menu {\n  display: flex;\n  list-style: none;\n  gap: 1rem;\n}\n\n.nav-link {\n  color: #ecf0f1;\n  text-decoration: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 6px;\n  transition: all 0.3s ease;\n  font-weight: 500;\n}\n\n.nav-link:hover,\n.nav-link:focus {\n  background-color: #34495e;\n  transform: translateY(-2px);\n}\n\n.nav-link.active {\n  background-color: #3498db;\n  font-weight: bold;\n}\n\n/* Main Content */\n.main-content {\n  min-height: calc(100vh - 140px);\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 2rem;\n}\n\n/* Page Transitions */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.page {\n  animation: fadeIn 0.5s ease-in-out;\n}\n\n/* Hero Section */\n.hero {\n  text-align: center;\n  padding: 3rem 0;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border-radius: 12px;\n  margin-bottom: 3rem;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.hero h1 {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  font-weight: bold;\n}\n\n.hero p {\n  font-size: 1.2rem;\n  opacity: 0.9;\n}\n\n/* Stories Section */\n.stories-section h2 {\n  font-size: 2rem;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  text-align: center;\n}\n\n/* Stories Header */\n.stories-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 2rem;\n}\n\n.stories-header h2 {\n  margin-bottom: 0;\n  margin-right: 1rem;\n}\n\n/* Story List */\n.story-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n  gap: 2rem;\n  margin-bottom: 3rem;\n}\n\n.story-card {\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  transition: all 0.3s ease;\n  border: 1px solid #e1e8ed;\n}\n\n.story-card:hover {\n  transform: translateY(-8px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n}\n\n.story-image {\n  width: 100%;\n  height: 220px;\n  object-fit: cover;\n  transition: transform 0.3s ease;\n}\n\n.story-card:hover .story-image {\n  transform: scale(1.05);\n}\n\n.story-content {\n  padding: 1.5rem;\n}\n\n.story-title {\n  font-size: 1.3rem;\n  font-weight: bold;\n  margin-bottom: 0.75rem;\n  color: #2c3e50;\n  line-height: 1.3;\n}\n\n.story-description {\n  color: #666;\n  margin-bottom: 1.5rem;\n  line-height: 1.6;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.story-meta {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.9rem;\n  padding-top: 1rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n.story-author {\n  font-weight: bold;\n  color: #3498db;\n}\n\n.story-date {\n  color: #999;\n}\n\n/* Form Styles */\n.add-story-section h1 {\n  text-align: center;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  font-size: 2.5rem;\n}\n\n.form-container {\n  background: white;\n  padding: 2.5rem;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n  max-width: 700px;\n  margin: 0 auto;\n}\n\n.form-group {\n  margin-bottom: 2rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.75rem;\n  font-weight: 600;\n  color: #2c3e50;\n  font-size: 1.1rem;\n}\n\n.form-input,\n.form-textarea {\n  width: 100%;\n  padding: 1rem;\n  border: 2px solid #e1e8ed;\n  border-radius: 8px;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n  font-family: inherit;\n}\n\n.form-input:focus,\n.form-textarea:focus {\n  outline: none;\n  border-color: #3498db;\n  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);\n}\n\n.form-textarea {\n  resize: vertical;\n  min-height: 120px;\n}\n\n.form-help {\n  color: #666;\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n  display: block;\n}\n\n/* Form Validation */\n.form-input.error,\n.form-textarea.error {\n  border-color: #e74c3c;\n  box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);\n}\n\n.form-error {\n  color: #e74c3c;\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n  display: none;\n  font-weight: 500;\n}\n\n.form-message {\n  padding: 1rem;\n  border-radius: 8px;\n  margin-top: 1.5rem;\n  text-align: center;\n  font-weight: 500;\n}\n\n.form-message.error {\n  background-color: #fee;\n  color: #e74c3c;\n  border: 1px solid #fcc;\n}\n\n.form-message.success {\n  background-color: #efe;\n  color: #27ae60;\n  border: 1px solid #cfc;\n}\n\n.form-message.loading {\n  background-color: #eef;\n  color: #3498db;\n  border: 1px solid #ccf;\n}\n\n/* Camera */\n.camera-container {\n  text-align: center;\n  padding: 1.5rem;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  background-color: #fafafa;\n}\n\n.camera-video,\n.camera-preview {\n  width: 100%;\n  max-width: 400px;\n  border-radius: 8px;\n  margin-bottom: 1rem;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n}\n\n.camera-controls {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n/* Buttons */\n.btn {\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  text-decoration: none;\n  display: inline-block;\n  text-align: center;\n  min-width: 120px;\n}\n\n.btn:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.btn:active {\n  transform: translateY(0);\n}\n\n.btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.btn-primary {\n  background: linear-gradient(135deg, #3498db, #2980b9);\n  color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n  background: linear-gradient(135deg, #2980b9, #1f5f8b);\n}\n\n.btn-success {\n  background: linear-gradient(135deg, #27ae60, #229954);\n  color: white;\n}\n\n.btn-success:hover:not(:disabled) {\n  background: linear-gradient(135deg, #229954, #1e7e34);\n}\n\n.btn-secondary {\n  background: linear-gradient(135deg, #95a5a6, #7f8c8d);\n  color: white;\n}\n\n.btn-secondary:hover:not(:disabled) {\n  background: linear-gradient(135deg, #7f8c8d, #6c7b7d);\n}\n\n.btn-loading {\n  display: none;\n}\n\n/* Form Actions */\n.form-actions {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  margin-top: 2.5rem;\n  padding-top: 2rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n/* Map */\n.map-container {\n  height: 350px;\n  width: 100%;\n  border-radius: 8px;\n  overflow: hidden;\n  margin-bottom: 1rem;\n  border: 2px solid #e1e8ed;\n}\n\n.location-info {\n  background: #f8f9fa;\n  padding: 0.75rem;\n  border-radius: 6px;\n  margin-top: 0.75rem;\n  font-family: "Courier New", monospace;\n  font-size: 0.9rem;\n  color: #495057;\n  border: 1px solid #dee2e6;\n}\n\n/* Map Section */\n.map-section {\n  margin-top: 4rem;\n  padding: 2.5rem;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n}\n\n.map-section h3 {\n  margin-bottom: 1.5rem;\n  color: #2c3e50;\n  font-size: 1.8rem;\n  text-align: center;\n}\n\n/* Map Popup */\n.map-popup h4 {\n  margin: 0 0 0.5rem 0;\n  color: #2c3e50;\n  font-size: 1.1rem;\n}\n\n.map-popup p {\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n  color: #555;\n}\n\n.map-popup small {\n  color: #888;\n  font-style: italic;\n}\n\n/* Loading */\n.loading {\n  text-align: center;\n  padding: 3rem;\n  font-size: 1.2rem;\n  color: #666;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n/* Error */\n.error {\n  background-color: #fee;\n  color: #e74c3c;\n  padding: 1.5rem;\n  border-radius: 8px;\n  margin: 1rem 0;\n  text-align: center;\n  border: 1px solid #fcc;\n}\n\n/* Success */\n.success {\n  background-color: #efe;\n  color: #27ae60;\n  padding: 1.5rem;\n  border-radius: 8px;\n  margin: 1rem 0;\n  text-align: center;\n  border: 1px solid #cfc;\n}\n\n/* No Stories */\n.no-stories {\n  text-align: center;\n  color: #666;\n  font-style: italic;\n  padding: 3rem;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n/* Footer */\n.footer {\n  background: #2c3e50;\n  color: #ecf0f1;\n  text-align: center;\n  padding: 1.5rem;\n  margin-top: 3rem;\n}\n\n/* View Transition API */\n@view-transition {\n  navigation: auto;\n}\n\n::view-transition-old(root),\n::view-transition-new(root) {\n  animation-duration: 0.4s;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .nav-container {\n    flex-direction: column;\n    gap: 1rem;\n    padding: 0 1rem;\n  }\n\n  .nav-menu {\n    gap: 0.5rem;\n  }\n\n  .main-content {\n    padding: 1rem;\n  }\n\n  .hero {\n    padding: 2rem 1rem;\n    margin-bottom: 2rem;\n  }\n\n  .hero h1 {\n    font-size: 2rem;\n  }\n\n  .story-list {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n  }\n\n  .form-container {\n    margin: 0 1rem;\n    padding: 1.5rem;\n  }\n\n  .form-actions {\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .camera-controls {\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .story-meta {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n  }\n\n  .map-section {\n    padding: 1.5rem;\n    margin-top: 2rem;\n  }\n\n  .stories-header {\n    flex-direction: column;\n    gap: 1rem;\n  }\n\n  .stories-header h2 {\n    margin-right: 0;\n  }\n}\n\n@media (max-width: 480px) {\n  .hero h1 {\n    font-size: 1.5rem;\n  }\n\n  .hero p {\n    font-size: 1rem;\n  }\n\n  .nav-title {\n    font-size: 1.5rem;\n  }\n\n  .story-card {\n    margin: 0 0.5rem;\n  }\n\n  .btn {\n    width: 100%;\n    max-width: 200px;\n  }\n}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: #f1f1f1;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #c1c1c1;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #a1a1a1;\n}\n\n/* Focus styles for accessibility */\n.btn:focus,\n.form-input:focus,\n.form-textarea:focus,\n.nav-link:focus {\n  outline: 2px solid #3498db;\n  outline-offset: 2px;\n}\n\n/* Print styles */\n@media print {\n  .navbar,\n  .footer,\n  .btn,\n  .camera-container,\n  .map-container {\n    display: none;\n  }\n\n  .story-list {\n    grid-template-columns: 1fr;\n  }\n\n  .story-card {\n    break-inside: avoid;\n    margin-bottom: 1rem;\n  }\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Loading Spinner */\n.loading-spinner {\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  border: 3px solid #f3f3f3;\n  border-top: 3px solid #3498db;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-right: 8px;\n}\n\n.loading-spinner.small {\n  width: 16px;\n  height: 16px;\n  border-width: 2px;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Loading container */\n.loading {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.loading .loading-spinner {\n  width: 40px;\n  height: 40px;\n  border-width: 4px;\n  margin-bottom: 1rem;\n}\n\n/* Error actions */\n.error-actions {\n  margin-top: 1rem;\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n\n/* Button loading state */\n.btn-loading {\n  display: none;\n  align-items: center;\n}\n\n/* No stories styling */\n.no-stories {\n  text-align: center;\n  padding: 3rem;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n}\n\n.no-stories h3 {\n  color: #2c3e50;\n  margin-bottom: 1rem;\n  font-size: 1.5rem;\n}\n\n.no-stories p {\n  color: #666;\n  margin-bottom: 2rem;\n  font-size: 1.1rem;\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Auth Section */\n.auth-section {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 60vh;\n  padding: 2rem;\n}\n\n.auth-container {\n  width: 100%;\n  max-width: 450px;\n}\n\n.auth-container h1 {\n  text-align: center;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  font-size: 2rem;\n}\n\n.auth-switch {\n  text-align: center;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n.auth-switch p {\n  color: #666;\n}\n\n.link {\n  color: #3498db;\n  text-decoration: none;\n  font-weight: 500;\n}\n\n.link:hover {\n  text-decoration: underline;\n}\n\n/* Demo Credentials */\n.demo-credentials {\n  background: #f8f9fa;\n  padding: 1rem;\n  border-radius: 6px;\n  margin: 1rem 0;\n  border-left: 4px solid #3498db;\n}\n\n.demo-credentials p {\n  margin: 0.25rem 0;\n  font-family: monospace;\n  font-size: 0.9rem;\n}\n\n/* User Menu */\n.user-menu {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.user-name {\n  color: #ecf0f1;\n  font-weight: 500;\n}\n\n.btn-small {\n  padding: 0.5rem 1rem;\n  font-size: 0.9rem;\n}\n\n/* Responsive Auth */\n@media (max-width: 768px) {\n  .auth-section {\n    padding: 1rem;\n  }\n\n  .auth-container {\n    max-width: 100%;\n  }\n\n  .user-menu {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Story location info */\n.story-location {\n  font-size: 0.8rem;\n  color: #666;\n  margin-top: 0.25rem;\n}\n\n/* Map no data */\n.map-no-data {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #f8f9fa;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  color: #666;\n  font-style: italic;\n}\n\n/* Map popup improvements */\n.map-popup {\n  max-width: 250px;\n}\n\n.map-popup h4 {\n  margin: 0 0 0.5rem 0;\n  color: #2c3e50;\n  font-size: 1rem;\n}\n\n.map-popup p {\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n  color: #555;\n  font-size: 0.9rem;\n}\n\n.map-popup small {\n  color: #888;\n  font-size: 0.8rem;\n  display: block;\n  margin-bottom: 0.25rem;\n}\n\n/* Story card improvements */\n.story-meta {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid #e1e8ed;\n  font-size: 0.875rem;\n}\n\n.story-meta p {\n  margin: 0;\n}\n\n.story-author {\n  font-weight: bold;\n  color: #3498db;\n}\n\n.story-date {\n  color: #999;\n}\n\n/* Responsive updates */\n@media (max-width: 768px) {\n  .story-meta {\n    font-size: 0.8rem;\n  }\n\n  .map-popup {\n    max-width: 200px;\n  }\n\n  .map-popup h4 {\n    font-size: 0.9rem;\n  }\n\n  .map-popup p {\n    font-size: 0.8rem;\n  }\n}\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Map error styling */\n.map-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #fee;\n  border: 2px dashed #e74c3c;\n  border-radius: 8px;\n  color: #e74c3c;\n  text-align: center;\n}\n\n.map-error p {\n  margin: 0 0 0.5rem 0;\n  font-weight: bold;\n}\n\n.map-error small {\n  color: #c0392b;\n  font-style: italic;\n}\n\n/* Map no data improvements */\n.map-no-data {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #f8f9fa;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  color: #666;\n  text-align: center;\n}\n\n.map-no-data p {\n  margin: 0 0 0.5rem 0;\n  font-weight: 500;\n}\n\n.map-no-data small {\n  color: #999;\n  font-style: italic;\n}\n\n/* Offline notification */\n.offline-notification {\n  background-color: #f8d7da;\n  color: #721c24;\n  padding: 10px 15px;\n  margin: 10px 0;\n  border-radius: 4px;\n  border-left: 5px solid #f5c6cb;\n  font-weight: 500;\n}\n\n/* Notification styles */\n.notification {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  padding: 15px 20px;\n  border-radius: 4px;\n  color: white;\n  font-weight: 500;\n  z-index: 1000;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n  animation: slideIn 0.3s ease-out forwards;\n}\n\n.notification.success {\n  background-color: #28a745;\n}\n\n.notification.error {\n  background-color: #dc3545;\n}\n\n.notification.fade-out {\n  animation: fadeOut 0.5s ease-out forwards;\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n@keyframes fadeOut {\n  from {\n    opacity: 1;\n  }\n  to {\n    opacity: 0;\n  }\n}\n\n/* Favorites page styles */\n.favorites-section {\n  padding: 20px;\n}\n\n.favorites-container {\n  margin-top: 20px;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 30px;\n  background-color: #f8f9fa;\n  border-radius: 8px;\n  margin: 20px 0;\n}\n\n.error-state {\n  text-align: center;\n  padding: 30px;\n  background-color: #f8d7da;\n  border-radius: 8px;\n  margin: 20px 0;\n  color: #721c24;\n}\n\n/* Saved stories page styles */\n.saved-stories-section {\n  padding: 20px;\n}\n\n.saved-stories-container {\n  margin-top: 20px;\n}\n\n/* Story actions */\n.story-actions {\n  display: flex;\n  gap: 10px;\n  margin-top: 15px;\n}\n\n/* Push notification prompt */\n.notification-prompt {\n  background-color: #cce5ff;\n  color: #004085;\n  padding: 15px;\n  margin-bottom: 20px;\n  border-radius: 4px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.notification-prompt p {\n  margin: 0;\n  flex: 1;\n}\n\n.notification-prompt .success {\n  color: #155724;\n  background-color: #d4edda;\n  padding: 10px;\n  border-radius: 4px;\n  width: 100%;\n  text-align: center;\n  margin-top: 10px;\n}\n\n.notification-prompt .error {\n  color: #721c24;\n  background-color: #f8d7da;\n  padding: 10px;\n  border-radius: 4px;\n  width: 100%;\n  text-align: center;\n  margin-top: 10px;\n}\n\n/* Loading indicator */\n.loading-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 30px;\n  color: #6c757d;\n}\n\n.loading-spinner {\n  border: 4px solid #f3f3f3;\n  border-top: 4px solid #3498db;\n  border-radius: 50%;\n  width: 30px;\n  height: 30px;\n  animation: spin 1s linear infinite;\n  margin-bottom: 10px;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Notification container */\n.notification-container {\n  margin-bottom: 20px;\n}\n\n/* Notification prompt */\n.notification-prompt {\n  padding: 15px;\n  border-radius: 4px;\n  margin-bottom: 15px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.notification-prompt p {\n  margin: 0;\n  flex: 1;\n}\n\n.notification-prompt button {\n  margin-left: 10px;\n}\n\n/* Notification prompt types */\n.notification-prompt.success {\n  background-color: #d4edda;\n  color: #155724;\n  border: 1px solid #c3e6cb;\n}\n\n.notification-prompt.error {\n  background-color: #f8d7da;\n  color: #721c24;\n  border: 1px solid #f5c6cb;\n}\n\n.notification-prompt.warning {\n  background-color: #fff3cd;\n  color: #856404;\n  border: 1px solid #ffeeba;\n}\n\n.notification-prompt.info {\n  background-color: #cce5ff;\n  color: #004085;\n  border: 1px solid #b8daff;\n}\n\n/* Notification opt-in checkbox */\n.notification-opt-in {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.notification-opt-in input[type="checkbox"] {\n  margin-right: 10px;\n}\n\n/* Success and error messages */\n.success-message,\n.error-message {\n  padding: 10px 15px;\n  margin-bottom: 15px;\n  border-radius: 4px;\n  font-weight: 500;\n}\n\n.success-message {\n  background-color: #d4edda;\n  color: #155724;\n  border: 1px solid #c3e6cb;\n}\n\n.error-message {\n  background-color: #f8d7da;\n  color: #721c24;\n  border: 1px solid #f5c6cb;\n}\n',""]);const a=s},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);o&&s[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),t&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=t):l[2]=t),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),n.push(l))}},n}},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var i=t.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={id:o,exports:{}};return e[o](i,i.exports,t),i.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;var o=t(72),r=t.n(o),i=t(825),s=t.n(i),a=t(659),c=t.n(a),d=t(56),l=t.n(d),m=t(540),p=t.n(m),h=t(113),u=t.n(h),g=t(159),f={};f.styleTagTransform=u(),f.setAttributes=l(),f.insert=c().bind(null,"head"),f.domAPI=s(),f.insertStyleElement=p(),r()(g.A,f),g.A&&g.A.locals&&g.A.locals;class v{constructor(){this.routes={},this.currentRoute=null,this.init()}init(){window.addEventListener("hashchange",(()=>this.handleRoute())),window.addEventListener("load",(()=>this.handleRoute()))}addRoute(e,n){this.routes[e]=n}handleRoute(){const e=window.location.hash.slice(1)||"/home",n=this.routes[e]||this.routes["/home"];n&&"function"==typeof n&&(document.startViewTransition?document.startViewTransition((()=>{n()})):n())}navigate(e){window.location.hash=e}getCurrentRoute(){return window.location.hash.slice(1)||"/home"}}const y="https://story-api.dicoding.dev/v1",b=-6.2,w=106.816666,x=10;class S{constructor(e,n={}){this.containerId=e,this.options={clickable:!1,showPopup:!0,center:[b,w],zoom:x,...n},this.map=null,this.markers=[],this.selectedLocation=null,this.selectionMarker=null}init(){this.createMap(),this.options.clickable&&this.enableLocationSelection()}createMap(){this.map=L.map(this.containerId).setView(this.options.center,this.options.zoom),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors"}).addTo(this.map)}enableLocationSelection(){this.map.on("click",(e=>{this.selectLocation(e.latlng)}))}selectLocation(e){const{lat:n,lng:t}=e;this.clearSelectionMarker(),this.selectionMarker=L.marker([n,t]).addTo(this.map),this.options.showPopup&&this.selectionMarker.bindPopup("Selected location").openPopup(),this.selectedLocation={lat:n,lng:t},this.options.onLocationSelect&&this.options.onLocationSelect(n,t)}addMarker(e,n,t="",o={}){const r=L.marker([e,n],o).addTo(this.map);return t&&r.bindPopup(t),this.markers.push(r),r}addMultipleMarkers(e){if(e.forEach((e=>{e.lat&&e.lng&&this.addMarker(e.lat,e.lng,e.popup||"",e.options||{})})),this.markers.length>0){const e=new L.featureGroup(this.markers);this.map.fitBounds(e.getBounds().pad(.1))}}clearSelectionMarker(){this.selectionMarker&&(this.map.removeLayer(this.selectionMarker),this.selectionMarker=null)}getSelectedLocation(){return this.selectedLocation}destroy(){this.map&&(this.map.remove(),this.map=null)}}class k{static setToken(e){localStorage.setItem("authToken",e)}static getToken(){return localStorage.getItem("authToken")}static removeToken(){localStorage.removeItem("authToken"),localStorage.removeItem("userInfo")}static setUserInfo(e){localStorage.setItem("userInfo",JSON.stringify(e))}static getUserInfo(){const e=localStorage.getItem("userInfo");return e?JSON.parse(e):null}static isAuthenticated(){return!!this.getToken()}static logout(){this.removeToken(),window.location.hash="/login"}}class E extends Error{constructor(e,n=null,t=!1){super(e),this.name="ApiError",this.status=n,this.isNetworkError=t}static handle(e){if(e instanceof E)switch(e.status){case 401:return"Session expired. Please login again.";case 403:return"You don't have permission to perform this action.";case 404:return"The requested resource was not found.";case 413:return"The file you're trying to upload is too large.";case 429:return"Too many requests. Please try again later.";case 500:return"Server error. Please try again later.";default:return e.isNetworkError?"Network error: Please check your internet connection.":e.message||"An unexpected error occurred."}return e.message||"An unexpected error occurred."}static isNetworkError(e){return"TypeError"===e.name&&(e.message.includes("fetch")||e.message.includes("network")||e.message.includes("Failed to fetch"))}}class I{static getAuthHeaders(){const e=k.getToken();return e?{Authorization:`Bearer ${e}`,Accept:"application/json"}:{Accept:"application/json"}}static async getAllStories(e=1,n=20,t=1){try{const o=new URLSearchParams({page:e.toString(),size:n.toString(),location:t.toString()}),r=`${y}/stories?${o}`;console.log("Fetching stories from:",r);const i=await fetch(r,{method:"GET",headers:this.getAuthHeaders()});if(!i.ok)throw new E("Failed to fetch stories",i.status);return await i.json()}catch(e){if(console.error("Error in getAllStories:",e),E.isNetworkError(e))throw new E("Failed to connect to the server",null,!0);if(e instanceof E)throw e;throw new E(e.message)}}static async getStoryDetail(e){try{console.log("Fetching story detail for ID:",e);const n=await fetch(`${y}/stories/${e}`,{method:"GET",headers:this.getAuthHeaders()});if(console.log("Story detail response status:",n.status),!n.ok){const e=await n.text();if(console.error("Error response:",e),401===n.status)throw new Error("Authentication failed. Please login again.");throw new Error(`HTTP ${n.status}: ${e}`)}const t=await n.json();return console.log("Story detail received:",t),t}catch(e){if(console.error("Error in getStoryDetail:",e),"TypeError"===e.name&&e.message.includes("fetch"))throw new Error("Network error: Please check your internet connection");throw e}}static async addStory(e){try{console.log("Adding story..."),console.log("FormData contents:");for(let[n,t]of e.entries())"photo"===n?console.log(n,"- File size:",t.size,"bytes"):console.log(n,":",t);const n=await fetch(`${y}/stories`,{method:"POST",headers:{Authorization:`Bearer ${k.getToken()}`},body:e});if(!n.ok){const e=await n.json().catch((()=>({})));throw new E(e.message||"Failed to add story",n.status)}const t=await n.json();return console.log("Story added successfully:",t),t}catch(e){if(console.error("Error in addStory:",e),E.isNetworkError(e))throw new E("Failed to connect to the server",null,!0);if(e instanceof E)throw e;throw new E(e.message)}}static async register(e){try{console.log("Registering user:",e.email);const n=await fetch(`${y}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await n.json();if(console.log("Register response:",t),!n.ok)throw new E(t.message||"Registration failed",n.status);return t}catch(e){if(console.error("Error in register:",e),E.isNetworkError(e))throw new E("Failed to connect to the server",null,!0);if(e instanceof E)throw e;throw new E(e.message)}}static async login(e){try{console.log("Logging in user:",e.email);const n=await fetch(`${y}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await n.json();if(console.log("Login response:",t),!n.ok)throw new E(t.message||"Login failed",n.status);return!1===t.error&&t.loginResult&&t.loginResult.token&&(k.setToken(t.loginResult.token),k.setUserInfo({userId:t.loginResult.userId,name:t.loginResult.name,email:e.email})),t}catch(e){if(console.error("Error in login:",e),E.isNetworkError(e))throw new E("Failed to connect to the server",null,!0);if(e instanceof E)throw e;throw new E(e.message)}}}const A=new class{constructor(){this.dbName="StoryAppDB",this.dbVersion=1,this.storeName="stories",this.favoriteStoreName="favoriteStories",this.db=null}async init(){return new Promise(((e,n)=>{if(this.db)return e(this.db);console.log("Opening IndexedDB...");const t=indexedDB.open(this.dbName,this.dbVersion);t.onerror=e=>{console.error("IndexedDB error:",e.target.error),n("Error opening database")},t.onsuccess=n=>{this.db=n.target.result,console.log("IndexedDB opened successfully"),e(this.db)},t.onupgradeneeded=e=>{const n=e.target.result;if(console.log("Creating object stores..."),!n.objectStoreNames.contains(this.storeName)){const e=n.createObjectStore(this.storeName,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}if(!n.objectStoreNames.contains(this.favoriteStoreName)){const e=n.createObjectStore(this.favoriteStoreName,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}}}))}async addStory(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.storeName],"readwrite"),r=o.objectStore(this.storeName);e.savedAt||(e.savedAt=(new Date).toISOString());const i=r.put(e);i.onsuccess=()=>{console.log("Story added to IndexedDB:",e.id),n(i.result)},i.onerror=e=>{console.error("Error adding story to IndexedDB:",e.target.error),t(e.target.error)},o.oncomplete=()=>{console.log("Transaction completed")}}))}catch(e){throw console.error("Failed to add story to IndexedDB:",e),e}}async getAllStories(){try{return await this.init(),new Promise(((e,n)=>{const t=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();t.onsuccess=()=>{console.log("Retrieved all stories from IndexedDB:",t.result.length),e(t.result)},t.onerror=e=>{console.error("Error getting stories from IndexedDB:",e.target.error),n(e.target.error)}}))}catch(e){throw console.error("Failed to get stories from IndexedDB:",e),e}}async getStory(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);o.onsuccess=()=>{o.result?(console.log("Retrieved story from IndexedDB:",e),n(o.result)):(console.log("Story not found in IndexedDB:",e),n(null))},o.onerror=e=>{console.error("Error getting story from IndexedDB:",e.target.error),t(e.target.error)}}))}catch(e){throw console.error("Failed to get story from IndexedDB:",e),e}}async deleteStory(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);o.onsuccess=()=>{console.log("Deleted story from IndexedDB:",e),n(!0)},o.onerror=e=>{console.error("Error deleting story from IndexedDB:",e.target.error),t(e.target.error)}}))}catch(e){throw console.error("Failed to delete story from IndexedDB:",e),e}}async addToFavorites(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.favoriteStoreName],"readwrite").objectStore(this.favoriteStoreName);e.isFavorite=!0,e.favoritedAt=(new Date).toISOString();const r=o.put(e);r.onsuccess=()=>{console.log("Story added to favorites:",e.id),n(r.result)},r.onerror=e=>{console.error("Error adding story to favorites:",e.target.error),t(e.target.error)}}))}catch(e){throw console.error("Failed to add story to favorites:",e),e}}async removeFromFavorites(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.favoriteStoreName],"readwrite").objectStore(this.favoriteStoreName).delete(e);o.onsuccess=()=>{console.log("Story removed from favorites:",e),n(!0)},o.onerror=e=>{console.error("Error removing story from favorites:",e.target.error),t(e.target.error)}}))}catch(e){throw console.error("Failed to remove story from favorites:",e),e}}async getAllFavorites(){try{return await this.init(),new Promise(((e,n)=>{const t=this.db.transaction([this.favoriteStoreName],"readonly").objectStore(this.favoriteStoreName).getAll();t.onsuccess=()=>{console.log("Retrieved all favorite stories:",t.result.length),e(t.result)},t.onerror=e=>{console.error("Error getting favorite stories:",e.target.error),n(e.target.error)}}))}catch(e){throw console.error("Failed to get favorite stories:",e),e}}async isFavorite(e){try{return await this.init(),new Promise(((n,t)=>{const o=this.db.transaction([this.favoriteStoreName],"readonly").objectStore(this.favoriteStoreName).get(e);o.onsuccess=()=>{n(!!o.result)},o.onerror=e=>{console.error("Error checking if story is favorite:",e.target.error),t(e.target.error)}}))}catch(e){throw console.error("Failed to check if story is favorite:",e),e}}async clearAllData(){try{return await this.init(),Promise.all([new Promise(((e,n)=>{const t=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();t.onsuccess=()=>{console.log("Cleared all stories from IndexedDB"),e(!0)},t.onerror=e=>{console.error("Error clearing stories:",e.target.error),n(e.target.error)}})),new Promise(((e,n)=>{const t=this.db.transaction([this.favoriteStoreName],"readwrite").objectStore(this.favoriteStoreName).clear();t.onsuccess=()=>{console.log("Cleared all favorite stories from IndexedDB"),e(!0)},t.onerror=e=>{console.error("Error clearing favorite stories:",e.target.error),n(e.target.error)}}))])}catch(e){throw console.error("Failed to clear all data from IndexedDB:",e),e}}},N=A;class B{constructor(e){this.view=e,this.stories=[]}async loadStories(){try{const e=await I.getAllStories();if(!1!==e.error||!e.listStory)throw new Error("Failed to load stories from API");this.stories=e.listStory,await this.saveStoriesToIndexedDB(this.stories),this.view.hideLoading(),this.view.renderStories(this.stories),this.stories.filter((e=>e.lat&&e.lon)).length>0&&this.view.renderStoriesMap(this.stories)}catch(e){console.error("Error loading stories from API:",e);try{console.log("Attempting to load stories from IndexedDB...");const e=await N.getAllStories();e&&e.length>0?(console.log("Loaded stories from IndexedDB:",e.length),this.stories=e,this.view.hideLoading(),this.view.renderStories(this.stories),this.view.showOfflineNotification(),this.stories.filter((e=>e.lat&&e.lon)).length>0&&this.view.renderStoriesMap(this.stories)):(this.view.hideLoading(),this.view.showNoStories())}catch(e){console.error("Error loading stories from IndexedDB:",e),this.view.hideLoading(),this.view.showError("Failed to load stories. Please check your internet connection and try again.")}}}async saveStoriesToIndexedDB(e){try{await N.init();for(const n of e)n.savedAt=(new Date).toISOString(),await N.isFavorite(n.id)&&(n.isFavorite=!0),await N.addStory(n);console.log(`Successfully saved ${e.length} stories to IndexedDB`)}catch(e){console.error("Error saving stories to IndexedDB:",e)}}async addStoryToFavorites(e){try{const n=this.stories.find((n=>n.id===e));if(!n)throw new Error("Story not found");return await N.addToFavorites(n),!0}catch(e){return console.error("Error adding story to favorites:",e),!1}}async removeStoryFromFavorites(e){try{return await N.removeFromFavorites(e),!0}catch(e){return console.error("Error removing story from favorites:",e),!1}}}class F{constructor(){this.presenter=new B(this)}async render(){const e=document.getElementById("page-container");if(!e)return void console.error("Page container not found");const n=k.isAuthenticated();e.innerHTML=`\n      <div class="page">\n        <section class="hero">\n          <h1>Welcome to Story App</h1>\n          <p>Discover amazing stories from around the world</p>\n        </section>\n        <div id="offline-notification" class="offline-notification" style="display: none;">\n          <p>You are currently offline. Showing saved stories.</p>\n        </div>\n        <section class="stories-section">\n          <div class="stories-header">\n            <h2>Latest Stories</h2>\n            ${n?'<a href="#/add" class="btn btn-primary">Add New Story</a>':'<a href="#/login" class="btn btn-primary">Login to Add Story</a>'}\n          </div>\n          <div class="loading" id="loading-indicator">\n            <div class="loading-spinner"></div>\n            <p>Loading Stories...</p>\n          </div>\n          <div id="stories-container"></div>\n        </section>\n      </div>\n    `,document.getElementById("stories-container")?await this.presenter.loadStories():console.error("Stories container not found")}renderStories(e){const n=document.getElementById("stories-container");e&&0!==e.length?(n.innerHTML=`\n      <div class="story-list">\n        ${e.map((e=>this.createStoryCard(e))).join("")}\n      </div>\n    `,this.addFavoriteButtonListeners()):n.innerHTML='\n        <div class="no-stories">\n          <h3>No stories available yet</h3>\n          <p>Be the first to share your story!</p>\n          <a href="#/add" class="btn btn-primary">Add Your Story</a>\n        </div>\n      '}createStoryCard(e){if(!e)return"";const n=e.id||"",t=e.name||"Anonymous",o=e.description||"No description available",r=e.photoUrl||"",i=e.isFavorite||!1;let s="Unknown date";if(e.createdAt)try{s=new Date(e.createdAt).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){console.warn("Invalid date format:",e.createdAt),s=e.createdAt}return`\n      <article class="story-card" data-story-id="${n}">\n        <img src="${r}" \n             alt="Story photo by ${this.escapeHtml(t)}" \n             class="story-image" \n             loading="lazy"\n             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIG5vdCBhdmFpbGFibGU8L3RleHQ+PC9zdmc+'">\n        <div class="story-content">\n          <h3 class="story-title">${this.escapeHtml(t)}</h3>\n          <p class="story-description">${this.escapeHtml(o.length>150?o.substring(0,150)+"...":o)}</p>\n          <div class="story-meta">\n            <p class="story-author">By: ${this.escapeHtml(t)}</p>\n            <p class="story-date">üìÖ ${s}</p>\n            ${e.lat&&e.lon?`<p class="story-location">üìç ${parseFloat(e.lat).toFixed(4)}, ${parseFloat(e.lon).toFixed(4)}</p>`:""}\n          </div>\n          <div class="story-actions">\n            ${k.isAuthenticated()?`\n              <button class="btn ${i?"btn-danger remove-favorite-btn":"btn-secondary add-favorite-btn"}" \n                      data-story-id="${n}">\n                ${i?"Remove from Favorites":"Add to Favorites"}\n              </button>\n            `:""}\n          </div>\n        </div>\n      </article>\n    `}addFavoriteButtonListeners(){document.querySelectorAll(".add-favorite-btn").forEach((e=>{e.addEventListener("click",(async n=>{const t=n.target.dataset.storyId;try{await this.presenter.addStoryToFavorites(t)&&(e.classList.remove("btn-secondary"),e.classList.add("btn-danger"),e.classList.remove("add-favorite-btn"),e.classList.add("remove-favorite-btn"),e.textContent="Remove from Favorites",e.removeEventListener("click",(()=>{})),e.addEventListener("click",this.handleRemoveFavorite.bind(this)),this.showNotification("Story added to favorites"))}catch(e){console.error("Error adding to favorites:",e),this.showNotification("Failed to add to favorites","error")}}))})),document.querySelectorAll(".remove-favorite-btn").forEach((e=>{e.addEventListener("click",this.handleRemoveFavorite.bind(this))}))}async handleRemoveFavorite(e){const n=e.target.dataset.storyId;try{if(await this.presenter.removeStoryFromFavorites(n)){const n=e.target;n.classList.remove("btn-danger"),n.classList.add("btn-secondary"),n.classList.remove("remove-favorite-btn"),n.classList.add("add-favorite-btn"),n.textContent="Add to Favorites",n.removeEventListener("click",this.handleRemoveFavorite),n.addEventListener("click",(async e=>{const n=e.target.dataset.storyId;await this.presenter.addStoryToFavorites(n)})),this.showNotification("Story removed from favorites")}}catch(e){console.error("Error removing from favorites:",e),this.showNotification("Failed to remove from favorites","error")}}showNotification(e,n="success"){const t=document.createElement("div");t.className=`notification ${n}`,t.textContent=e,document.body.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{document.body.removeChild(t)}),500)}),3e3)}showOfflineNotification(){const e=document.getElementById("offline-notification");e&&(e.style.display="block")}renderStoriesMap(e){const n=document.getElementById("stories-container");if(document.getElementById("stories-map"))return;const t=document.createElement("section");t.className="map-section",t.innerHTML='\n      <h2>Stories Around the World</h2>\n      <div id="stories-map" class="map-container"></div>\n    ',n.appendChild(t),setTimeout((()=>{try{const n=new S("stories-map",{clickable:!1,showPopup:!0,zoom:5});n.init();const t=e.filter((e=>e&&null!==e.lat&&void 0!==e.lat&&null!==e.lon&&void 0!==e.lon&&!isNaN(parseFloat(e.lat))&&!isNaN(parseFloat(e.lon))&&0!==parseFloat(e.lat)&&0!==parseFloat(e.lon))).map((e=>({lat:parseFloat(e.lat),lng:parseFloat(e.lon),popup:`\n              <div class="map-popup">\n                <h4>${this.escapeHtml(e.name||"Anonymous")}</h4>\n                <p>${this.escapeHtml((e.description||"").substring(0,100))}${(e.description||"").length>100?"...":""}</p>\n                <small>üìÖ ${e.createdAt?new Date(e.createdAt).toLocaleDateString("id-ID"):"Unknown date"}</small>\n                <br>\n                <small>üìç ${parseFloat(e.lat).toFixed(4)}, ${parseFloat(e.lon).toFixed(4)}</small>\n              </div>\n            `})));console.log("Story locations for map:",t),t.length>0?n.addMultipleMarkers(t):(console.warn("No valid story locations found for map"),document.getElementById("stories-map").innerHTML='\n            <div class="map-no-data">\n              <p>No location data available for stories</p>\n              <small>Stories need to have valid coordinates to appear on the map</small>\n            </div>\n          ')}catch(e){console.error("Error initializing map:",e);const n=document.querySelector(".map-section");n&&(n.innerHTML=`\n            <h2>Stories Around the World</h2>\n            <div class="map-error">\n              <p>Unable to load map</p>\n              <small>Error: ${e.message}</small>\n            </div>\n          `)}}),100)}hideLoading(){const e=document.getElementById("loading-indicator");e&&(e.style.display="none")}showNoStories(){const e=document.getElementById("stories-container"),n=k.isAuthenticated();e.innerHTML=`\n      <div class="no-stories">\n        <h3>No stories available yet</h3>\n        <p>Be the first to share your story!</p>\n        ${n?'<a href="#/add" class="btn btn-primary">Add Your Story</a>':'<a href="#/login" class="btn btn-primary">Login to Add Story</a>'}\n      </div>\n    `}showError(e,n="general"){const t=document.getElementById("stories-container");if(!t)return void console.error("Stories container not found when showing error");t.innerHTML=`\n      <div class="error-container error-${n}">\n        <div class="error-icon">‚ö†Ô∏è</div>\n        <h3>Error</h3>\n        <p>${e}</p>\n        <button id="retry-button" class="btn btn-primary">Try Again</button>\n      </div>\n    `;const o=document.getElementById("retry-button");o&&o.addEventListener("click",(()=>{this.render()}))}escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}destroy(){document.querySelectorAll(".add-favorite-btn").forEach((e=>{e.removeEventListener("click",(()=>{}))})),document.querySelectorAll(".remove-favorite-btn").forEach((e=>{e.removeEventListener("click",this.handleRemoveFavorite)}))}}class T{constructor(e){this.container=document.getElementById(e),this.stream=null,this.capturedBlob=null,this.init()}init(){this.createCameraElements(),this.bindEvents()}createCameraElements(){this.container.innerHTML='\n            <div class="camera-container">\n                <video id="camera-video" class="camera-video" autoplay style="display: none;"></video>\n                <canvas id="camera-canvas" style="display: none;"></canvas>\n                <img id="camera-preview" class="camera-preview" style="display: none;" alt="Captured photo preview">\n                <div class="camera-controls">\n                    <button type="button" id="start-camera" class="btn btn-primary">Start Camera</button>\n                    <button type="button" id="capture-photo" class="btn btn-success" style="display: none;">Capture Photo</button>\n                    <button type="button" id="retake-photo" class="btn btn-secondary" style="display: none;">Retake</button>\n                </div>\n            </div>\n        ',this.video=document.getElementById("camera-video"),this.canvas=document.getElementById("camera-canvas"),this.preview=document.getElementById("camera-preview"),this.startBtn=document.getElementById("start-camera"),this.captureBtn=document.getElementById("capture-photo"),this.retakeBtn=document.getElementById("retake-photo")}bindEvents(){this.startBtn.addEventListener("click",(()=>this.startCamera())),this.captureBtn.addEventListener("click",(()=>this.capturePhoto())),this.retakeBtn.addEventListener("click",(()=>this.retakePhoto()))}async startCamera(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480}}}),this.video.srcObject=this.stream,this.showElement(this.video),this.hideElement(this.startBtn),this.showElement(this.captureBtn)}catch(e){console.error("Error accessing camera:",e),this.showError("Error accessing camera: "+e.message)}}capturePhoto(){const e=this.canvas.getContext("2d");this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,e.drawImage(this.video,0,0),this.canvas.toBlob((e=>{this.capturedBlob=e;const n=URL.createObjectURL(e);this.preview.src=n,this.showElement(this.preview),this.hideElement(this.video),this.hideElement(this.captureBtn),this.showElement(this.retakeBtn),this.stopCamera()}),"image/jpeg",.8)}retakePhoto(){this.hideElement(this.preview),this.hideElement(this.retakeBtn),this.showElement(this.startBtn),this.capturedBlob=null,this.preview.src&&URL.revokeObjectURL(this.preview.src)}stopCamera(){this.stream&&(this.stream.getTracks().forEach((e=>e.stop())),this.stream=null)}getCapturedPhoto(){return this.capturedBlob}showElement(e){e.style.display="block"}hideElement(e){e.style.display="none"}showError(e){const n=document.createElement("div");n.className="error",n.textContent=e,this.container.appendChild(n),setTimeout((()=>{n.remove()}),5e3)}destroy(){this.stopCamera(),this.preview&&this.preview.src&&URL.revokeObjectURL(this.preview.src)}}class P{constructor(e,n){this.view=e,this.router=n}async addStory(e){try{console.log("Submitting story...");const n=await I.addStory(e);return!1===n.error?(this.view.showMessage("Story added successfully! Redirecting...","success"),setTimeout((()=>{this.router.navigate("/home")}),2e3)):this.view.showMessage(n.message||"Failed to add story","error"),n}catch(e){console.error("Error adding story:",e);const n=e instanceof E?E.handle(e):e.message||"Failed to add story. Please try again.";throw this.view.showMessage(n,"error"),e}}validateForm(e,n,t){let o=!0;return e?e.length<10?(this.view.showError("description-error","Description must be at least 10 characters"),o=!1):e.length>1e3?(this.view.showError("description-error","Description must not exceed 1000 characters"),o=!1):this.view.clearError("description-error"):(this.view.showError("description-error","Description is required"),o=!1),n?n.size>5242880?(this.view.showError("photo-error","Photo size must be less than 5MB"),o=!1):this.view.clearError("photo-error"):(this.view.showError("photo-error","Please capture a photo"),o=!1),t?this.view.clearError("location-error"):(this.view.showError("location-error","Please select a location"),o=!1),o}}const M=new class{constructor(){this.publicVapidKey="BN7-r0Svv7CsTi18-OPYtJLVW0bfuZ1x1UtrygczKjennA_qs7OWmgOewcuYSYF3Gc_mPbqsDh2YoGCDPL0W7Yo"}urlBase64ToUint8Array(e){const n=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(n),o=new Uint8Array(t.length);for(let e=0;e<t.length;++e)o[e]=t.charCodeAt(e);return o}async registerServiceWorker(){if(!("serviceWorker"in navigator))throw new Error("Service Worker not supported in this browser");try{const e=await navigator.serviceWorker.register("/service-worker.js");return console.log("Service Worker registered successfully:",e),e}catch(e){throw console.error("Service Worker registration failed:",e),e}}async subscribeToPushNotifications(){try{const e=await navigator.serviceWorker.ready;if(!("PushManager"in window))throw new Error("Push notifications not supported in this browser");if("granted"!==await Notification.requestPermission())throw new Error("Notification permission denied");let n=await e.pushManager.getSubscription();return n?console.log("Using existing push subscription:",n):(n=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.publicVapidKey)}),console.log("Created new push subscription:",n)),await this.sendSubscriptionToServer(n),n}catch(e){throw console.error("Error subscribing to push notifications:",e),e}}async unsubscribeFromPushNotifications(){try{const e=await navigator.serviceWorker.ready,n=await e.pushManager.getSubscription();if(n){await this.removeSubscriptionFromServer(n);const e=await n.unsubscribe();return console.log("Unsubscribed from push notifications:",e),e}return!1}catch(e){throw console.error("Error unsubscribing from push notifications:",e),e}}async sendSubscriptionToServer(e){try{if(!k.isAuthenticated())return console.warn("User not authenticated, cannot send subscription to server"),!1;const n=k.getToken(),t=btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("p256dh")))),o=btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("auth"))));console.log("Sending subscription to server with data:",{endpoint:e.endpoint,p256dh:t,auth:o});const r=await fetch(`${y}/push`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({endpoint:e.endpoint,p256dh:t,auth:o})});if(!r.ok){const e=await r.json();throw console.error("Server response error:",e),new Error(e.message||"Failed to send subscription to server")}const i=await r.json();return console.log("Subscription sent to server successfully:",i),i}catch(e){throw console.error("Error sending subscription to server:",e),e}}async removeSubscriptionFromServer(e){try{if(!k.isAuthenticated())return console.warn("User not authenticated, cannot remove subscription from server"),!1;const n=k.getToken(),t=await fetch(`${y}/push`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({endpoint:e.endpoint})});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to remove subscription from server")}const o=await t.json();return console.log("Subscription removed from server successfully:",o),o}catch(e){throw console.error("Error removing subscription from server:",e),e}}async checkPushSupport(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return{supported:!1,message:"Push notifications are not supported in your browser"};const e=Notification.permission;return"granted"===e?{supported:!0,message:"Push notifications are supported and enabled",permission:e}:"denied"===e?{supported:!1,message:"Notification permission denied",permission:e}:{supported:!0,message:"Push notifications are supported but not enabled yet",permission:e}}};class C{constructor(e){this.router=e,this.presenter=new P(this,e),this.camera=null,this.map=null,this.selectedLocation=null,this.mapComponent=null,this.photoPreview=null,this.selectedPosition=null}render(){document.getElementById("page-container").innerHTML='\n      <div class="page">\n        <h2 tabindex="-1" id="add-story-heading">Add New Story</h2>\n        <section class="add-story-section">\n          <div id="notification-container" class="notification-container"></div>\n          <form id="add-story-form" class="form-container" novalidate>\n            <div class="form-group">\n              <label for="story-description" class="form-label">Description *</label>\n              <textarea id="story-description" \n                name="description" \n                class="form-textarea" \n                required\n                placeholder="Tell your story..."\n                maxlength="1000"></textarea>\n              <small class="form-help">Maximum 1000 characters</small>\n              <div class="form-error" id="description-error"></div>\n            </div>\n            \n            <div class="form-group">\n              <label class="form-label">Photo *</label>\n              <div id="camera-container"></div>\n              <div class="form-error" id="photo-error"></div>\n            </div>\n            \n            <div class="form-group">\n              <label class="form-label">Location *</label>\n              <p class="form-help">Click on the map to select your story location</p>\n              <div id="location-map" class="map-container"></div>\n              <input type="hidden" id="latitude" name="lat">\n              <input type="hidden" id="longitude" name="lon">\n              <p id="location-info" class="location-info">No location selected</p>\n              <div class="form-error" id="location-error"></div>\n            </div>\n            \n            <div class="form-group notification-opt-in">\n              <label>\n                <input type="checkbox" id="enable-notifications" checked>\n                Enable notifications for new stories\n              </label>\n            </div>\n            \n            <div class="form-actions">\n              <button type="submit" class="btn btn-primary" id="submit-btn">\n                <span class="btn-text">Add Story</span>\n                <span class="btn-loading" style="display: none;">\n                  <span class="loading-spinner small"></span>\n                  Adding...\n                </span>\n              </button>\n              <button type="button" class="btn btn-secondary" onclick="history.back()">Cancel</button>\n            </div>\n            \n            <div id="form-message"></div>\n          </form>\n        </section>\n      </div>\n    ',setTimeout((()=>{this.initializeComponents(),this.initializeForm();const e=document.getElementById("add-story-heading");e&&e.focus(),this.setupPushNotificationSubscription()}),100)}initializeComponents(){try{this.camera=new T("camera-container"),this.map=new S("location-map",{clickable:!0,showPopup:!0,onLocationSelect:(e,n)=>this.onLocationSelect(e,n)}),this.map.init()}catch(e){console.error("Error initializing components:",e),this.showMessage("Error initializing components. Please refresh the page.","error")}}onLocationSelect(e,n){this.selectedLocation={lat:e,lng:n},document.getElementById("latitude").value=e,document.getElementById("longitude").value=n,document.getElementById("location-info").textContent=`Selected: ${e.toFixed(6)}, ${n.toFixed(6)}`,this.clearError("location-error")}initializeForm(){document.getElementById("add-story-form").addEventListener("submit",(e=>this.handleSubmit(e)))}async handleSubmit(e){e.preventDefault();const n=document.getElementById("story-description").value.trim(),t=this.camera?.getCapturedPhoto();if(!this.presenter.validateForm(n,t,this.selectedLocation))return void this.showMessage("Please fill all required fields","error");const o=document.getElementById("submit-btn"),r=o.querySelector(".btn-text"),i=o.querySelector(".btn-loading");o.disabled=!0,r.style.display="none",i.style.display="inline-flex";try{const e=this.prepareFormData();await this.presenter.addStory(e)}catch(e){console.error("Error submitting story:",e)}finally{o.disabled=!1,r.style.display="inline",i.style.display="none"}}prepareFormData(){const e=new FormData,n=document.getElementById("story-description").value.trim(),t=this.camera.getCapturedPhoto(),{lat:o,lng:r}=this.selectedLocation;if(!(n&&t&&o&&r))throw new Error("All fields are required");if(!(t instanceof Blob))throw new Error("Invalid photo format");if(isNaN(o)||isNaN(r))throw new Error("Invalid location coordinates");return e.append("description",n),e.append("photo",t,`story-${Date.now()}.jpg`),e.append("lat",parseFloat(o).toString()),e.append("lon",parseFloat(r).toString()),e}showMessage(e,n){const t=document.getElementById("form-message");t.className=`form-message ${n}`,t.textContent=e,t.scrollIntoView({behavior:"smooth",block:"nearest"})}showError(e,n){const t=document.getElementById(e);t&&(t.textContent=n,t.style.display="block")}clearError(e){const n=document.getElementById(e);n&&(n.textContent="",n.style.display="none")}destroy(){try{this.camera&&this.camera.destroy(),this.map&&this.map.destroy()}catch(e){console.error("Error destroying view:",e)}}initMap(){setTimeout((()=>{try{this.mapComponent=new S("location-map",{clickable:!0,showPopup:!1,zoom:5}),this.mapComponent.init(),this.mapComponent.onMapClick((e=>{const{lat:n,lng:t}=e.latlng;this.selectedPosition={lat:n,lng:t},this.updateLocationInfo(),this.mapComponent.addMarker(n,t)}))}catch(e){console.error("Error initializing map:",e),document.getElementById("location-map").innerHTML=`\n          <div class="map-error">\n            <p>Unable to load map</p>\n            <small>Error: ${e.message}</small>\n          </div>\n        `}}),100)}updateLocationInfo(){const e=document.getElementById("location-info");if(this.selectedPosition){const{lat:n,lng:t}=this.selectedPosition;e.innerHTML=`\n        <p>Selected location: ${n.toFixed(6)}, ${t.toFixed(6)}</p>\n      `}else e.innerHTML="<p>No location selected</p>"}setupPhotoPreview(){const e=document.getElementById("story-description"),n=document.getElementById("camera-container");e.addEventListener("change",(e=>{const t=e.target.files[0];if(!t)return n.innerHTML="<p>No photo selected</p>",void(this.photoPreview=null);if(!t.type.startsWith("image/"))return n.innerHTML='<p class="error">Please select an image file</p>',void(this.photoPreview=null);const o=new FileReader;o.onload=e=>{this.photoPreview=e.target.result,n.innerHTML=`\n          <img src="${this.photoPreview}" alt="Preview" class="photo-preview" />\n        `},o.readAsDataURL(t)}))}async setupPushNotificationSubscription(){try{const e=await M.checkPushSupport(),n=document.getElementById("notification-container");if(!e.supported)return void(n.innerHTML='\n          <div class="notification-prompt warning">\n            <p>Your browser doesn\'t support push notifications.</p>\n          </div>\n        ');"denied"===e.permission?n.innerHTML='\n          <div class="notification-prompt warning">\n            <p>Push notifications are blocked. Please enable them in your browser settings.</p>\n          </div>\n        ':"default"===e.permission?(n.innerHTML='\n          <div class="notification-prompt">\n            <p>Get notified when new stories are added!</p>\n            <button class="btn btn-primary" id="enable-notifications-btn">Enable Notifications</button>\n          </div>\n        ',document.getElementById("enable-notifications-btn").addEventListener("click",(async()=>{try{await M.subscribeToPushNotifications(),n.innerHTML='\n              <div class="notification-prompt success">\n                <p>Notifications enabled successfully!</p>\n              </div>\n            ',setTimeout((()=>{n.innerHTML=""}),3e3)}catch(e){console.error("Failed to enable notifications:",e),n.innerHTML=`\n              <div class="notification-prompt error">\n                <p>Failed to enable notifications: ${e.message}</p>\n              </div>\n            `}}))):console.log("Push notifications already enabled")}catch(e){console.error("Error checking push notification support:",e)}}}class D{constructor(e){this.router=e}render(){document.getElementById("page-container").innerHTML='\n            <div class="page">\n                <section class="auth-section">\n                    <div class="auth-container">\n                        <h1>Login to Story App</h1>\n                        <form id="login-form" class="form-container">\n                            <div class="form-group">\n                                <label for="login-email" class="form-label">Email *</label>\n                                <input type="email" \n                                       id="login-email" \n                                       name="email" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your email">\n                                <div class="form-error" id="email-error"></div>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="login-password" class="form-label">Password *</label>\n                                <input type="password" \n                                       id="login-password" \n                                       name="password" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your password">\n                                <div class="form-error" id="password-error"></div>\n                            </div>\n                            \n                            <div class="form-actions">\n                                <button type="submit" class="btn btn-primary" id="login-btn">\n                                    <span class="btn-text">Login</span>\n                                    <span class="btn-loading" style="display: none;">\n                                        <span class="loading-spinner small"></span>\n                                        Logging in...\n                                    </span>\n                                </button>\n                            </div>\n                            \n                            <div id="login-message"></div>\n                        </form>\n                        \n                        <div class="auth-switch">\n                            <p>Don\'t have an account? <a href="#/register" class="link">Register here</a></p>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        ',this.initializeForm()}initializeForm(){document.getElementById("login-form").addEventListener("submit",(e=>this.handleLogin(e)))}async handleLogin(e){e.preventDefault();const n=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value;if(!n||!t)return void this.showMessage("Please fill in all fields","error");const o=document.getElementById("login-btn"),r=o.querySelector(".btn-text"),i=o.querySelector(".btn-loading");o.disabled=!0,r.style.display="none",i.style.display="inline-flex";try{const e=await I.login({email:n,password:t});!1===e.error&&e.loginResult?(this.showMessage("Login successful! Redirecting...","success"),setTimeout((()=>{this.router.navigate("/home"),window.app&&window.app.updateNavbar&&window.app.updateNavbar()}),1500)):this.showMessage(e.message||"Login failed","error")}catch(e){console.error("Login error:",e),this.showMessage(e.message||"Login failed","error")}finally{o.disabled=!1,r.style.display="inline",i.style.display="none"}}showMessage(e,n){const t=document.getElementById("login-message");t.className=`form-message ${n}`,t.textContent=e}}class z{constructor(e){this.router=e}render(){document.getElementById("page-container").innerHTML='\n            <div class="page">\n                <section class="auth-section">\n                    <div class="auth-container">\n                        <h1>Register to Story App</h1>\n                        <form id="register-form" class="form-container">\n                            <div class="form-group">\n                                <label for="register-name" class="form-label">Full Name *</label>\n                                <input type="text" \n                                       id="register-name" \n                                       name="name" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your full name">\n                                <div class="form-error" id="name-error"></div>\n                            </div>\n\n                            <div class="form-group">\n                                <label for="register-email" class="form-label">Email *</label>\n                                <input type="email" \n                                       id="register-email" \n                                       name="email" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your email">\n                                <div class="form-error" id="email-error"></div>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="register-password" class="form-label">Password *</label>\n                                <input type="password" \n                                       id="register-password" \n                                       name="password" \n                                       class="form-input" \n                                       required\n                                       minlength="8"\n                                       placeholder="Minimum 8 characters">\n                                <small class="form-help">Password must be at least 8 characters</small>\n                                <div class="form-error" id="password-error"></div>\n                            </div>\n                            \n                            <div class="form-actions">\n                                <button type="submit" class="btn btn-primary" id="register-btn">\n                                    <span class="btn-text">Register</span>\n                                    <span class="btn-loading" style="display: none;">\n                                        <span class="loading-spinner small"></span>\n                                        Creating account...\n                                    </span>\n                                </button>\n                            </div>\n                            \n                            <div id="register-message"></div>\n                        </form>\n                        \n                        <div class="auth-switch">\n                            <p>Already have an account? <a href="#/login" class="link">Login here</a></p>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        ',this.initializeForm()}initializeForm(){document.getElementById("register-form").addEventListener("submit",(e=>this.handleRegister(e)))}async handleRegister(e){e.preventDefault();const n=document.getElementById("register-name").value.trim(),t=document.getElementById("register-email").value.trim(),o=document.getElementById("register-password").value;if(!n||!t||!o)return void this.showMessage("Please fill in all fields","error");if(o.length<8)return void this.showMessage("Password must be at least 8 characters","error");const r=document.getElementById("register-btn"),i=r.querySelector(".btn-text"),s=r.querySelector(".btn-loading");r.disabled=!0,i.style.display="none",s.style.display="inline-flex";try{const e=await I.register({name:n,email:t,password:o});!1===e.error?(this.showMessage("Registration successful! Please login to continue.","success"),setTimeout((()=>{this.router.navigate("/login")}),2e3)):this.showMessage(e.message||"Registration failed","error")}catch(e){console.error("Registration error:",e),this.showMessage(e.message||"Registration failed","error")}finally{r.disabled=!1,i.style.display="inline",s.style.display="none"}}showMessage(e,n){const t=document.getElementById("register-message");t.className=`form-message ${n}`,t.textContent=e}}class ${constructor(){this.container=document.getElementById("page-container"),this.favoriteStories=[]}async render(){this.container.innerHTML='\n      <section class="favorites-section">\n        <h2>Your Favorite Stories</h2>\n        <p>Stories you\'ve marked as favorites.</p>\n        <div class="favorites-container" id="favorites-container">\n          <div class="loading-indicator">Loading favorites...</div>\n        </div>\n      </section>\n    ',await this.loadFavorites()}async loadFavorites(){try{const e=document.getElementById("favorites-container");if(this.favoriteStories=await N.getAllFavorites(),0===this.favoriteStories.length)return void(e.innerHTML='\n          <div class="empty-state">\n            <p>You haven\'t added any stories to your favorites yet.</p>\n            <p>Browse stories and click the heart icon to add them to your favorites.</p>\n          </div>\n        ');this.favoriteStories.sort(((e,n)=>new Date(n.favoritedAt)-new Date(e.favoritedAt))),e.innerHTML=this.favoriteStories.map((e=>`\n          <div class="story-card" data-id="${e.id}">\n            <div class="story-image">\n              <img src="${e.photoUrl}" alt="${e.name}'s story" loading="lazy">\n            </div>\n            <div class="story-content">\n              <h3 class="story-title">${e.name}</h3>\n              <p class="story-description">${e.description}</p>\n              <div class="story-meta">\n                <span class="story-date">Added to favorites: ${this.formatDate(e.favoritedAt)}</span>\n              </div>\n              <div class="story-actions">\n                <button class="btn btn-danger remove-favorite-btn" data-id="${e.id}">\n                  Remove from Favorites\n                </button>\n              </div>\n            </div>\n          </div>\n        `)).join(""),this.addRemoveButtonListeners()}catch(e){console.error("Error loading favorites:",e),document.getElementById("favorites-container").innerHTML=`\n        <div class="error-state">\n          <p>Failed to load your favorite stories.</p>\n          <p>Error: ${e.message}</p>\n        </div>\n      `}}addRemoveButtonListeners(){document.querySelectorAll(".remove-favorite-btn").forEach((e=>{e.addEventListener("click",(async e=>{const n=e.target.dataset.id;try{await N.removeFromFavorites(n),await this.loadFavorites(),this.showNotification("Story removed from favorites")}catch(e){console.error("Error removing from favorites:",e),this.showNotification("Failed to remove from favorites","error")}}))}))}showNotification(e,n="success"){const t=document.createElement("div");t.className=`notification ${n}`,t.textContent=e,document.body.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{document.body.removeChild(t)}),500)}),3e3)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}destroy(){document.querySelectorAll(".remove-favorite-btn").forEach((e=>{e.removeEventListener("click",(()=>{}))}))}}class R{constructor(){this.container=document.getElementById("page-container"),this.savedStories=[]}async render(){this.container.innerHTML='\n      <section class="saved-stories-section">\n        <h2>Your Saved Stories</h2>\n        <p>Stories saved for offline viewing.</p>\n        <div class="saved-stories-container" id="saved-stories-container">\n          <div class="loading-indicator">Loading saved stories...</div>\n        </div>\n      </section>\n    ',await this.loadSavedStories()}async loadSavedStories(){try{const e=document.getElementById("saved-stories-container");if(this.savedStories=await N.getAllStories(),0===this.savedStories.length)return void(e.innerHTML='\n          <div class="empty-state">\n            <p>You haven\'t saved any stories yet.</p>\n            <p>Stories you view will be automatically saved for offline viewing.</p>\n          </div>\n        ');this.savedStories.sort(((e,n)=>new Date(n.savedAt)-new Date(e.savedAt))),e.innerHTML=this.savedStories.map((e=>`\n          <div class="story-card" data-id="${e.id}">\n            <div class="story-image">\n              <img src="${e.photoUrl}" alt="${e.name}'s story" loading="lazy">\n            </div>\n            <div class="story-content">\n              <h3 class="story-title">${e.name}</h3>\n              <p class="story-description">${e.description}</p>\n              <div class="story-meta">\n                <span class="story-date">Saved: ${this.formatDate(e.savedAt)}</span>\n              </div>\n              <div class="story-actions">\n                <button class="btn btn-danger delete-story-btn" data-id="${e.id}">\n                  Delete from Saved Stories\n                </button>\n                ${e.isFavorite?"":`\n                <button class="btn btn-primary add-favorite-btn" data-id="${e.id}">\n                  Add to Favorites\n                </button>\n                `}\n              </div>\n            </div>\n          </div>\n        `)).join(""),this.addButtonListeners()}catch(e){console.error("Error loading saved stories:",e),document.getElementById("saved-stories-container").innerHTML=`\n        <div class="error-state">\n          <p>Failed to load your saved stories.</p>\n          <p>Error: ${e.message}</p>\n        </div>\n      `}}addButtonListeners(){document.querySelectorAll(".delete-story-btn").forEach((e=>{e.addEventListener("click",(async e=>{const n=e.target.dataset.id;try{await N.deleteStory(n),await this.loadSavedStories(),this.showNotification("Story deleted from saved stories")}catch(e){console.error("Error deleting story:",e),this.showNotification("Failed to delete story","error")}}))})),document.querySelectorAll(".add-favorite-btn").forEach((e=>{e.addEventListener("click",(async e=>{const n=e.target.dataset.id;try{const e=this.savedStories.find((e=>e.id===n));e&&(await N.addToFavorites(e),await this.loadSavedStories(),this.showNotification("Story added to favorites"))}catch(e){console.error("Error adding to favorites:",e),this.showNotification("Failed to add to favorites","error")}}))}))}showNotification(e,n="success"){const t=document.createElement("div");t.className=`notification ${n}`,t.textContent=e,document.body.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{document.body.removeChild(t)}),500)}),3e3)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}destroy(){document.querySelectorAll(".delete-story-btn").forEach((e=>{e.removeEventListener("click",(()=>{}))})),document.querySelectorAll(".add-favorite-btn").forEach((e=>{e.removeEventListener("click",(()=>{}))}))}}class j{constructor(){this.router=new v,this.currentView=null,this.init(),this.setupSkipToContent()}async init(){try{await N.init(),console.log("IndexedDB initialized successfully")}catch(e){console.error("Failed to initialize IndexedDB:",e)}this.setupRoutes(),this.setupNavigation(),this.setupAuthCheck(),window.addEventListener("unhandledrejection",(e=>{console.error("Unhandled promise rejection:",e.reason)})),this.router.handleRoute(),this.registerServiceWorker()}registerServiceWorker(){"serviceWorker"in navigator?setTimeout((async()=>{try{const e=await navigator.serviceWorker.register("/service-worker.js");console.log("ServiceWorker registration successful with scope:",e.scope),k.isAuthenticated()&&this.subscribeToPushNotifications()}catch(e){console.error("ServiceWorker registration failed:",e)}}),1e3):console.warn("Service workers are not supported in this browser")}async subscribeToPushNotifications(){try{const e=await M.checkPushSupport();e.supported&&"granted"===e.permission?(await M.subscribeToPushNotifications(),console.log("Successfully subscribed to push notifications")):e.supported&&"denied"!==e.permission&&"granted"===await Notification.requestPermission()&&(await M.subscribeToPushNotifications(),console.log("Successfully subscribed to push notifications after permission grant"))}catch(e){console.error("Failed to subscribe to push notifications:",e)}}setupRoutes(){this.router.addRoute("/home",(()=>this.renderHome())),this.router.addRoute("/add",(()=>this.renderAddStory())),this.router.addRoute("/login",(()=>this.renderLogin())),this.router.addRoute("/register",(()=>this.renderRegister())),this.router.addRoute("/favorites",(()=>this.renderFavorites())),this.router.addRoute("/saved",(()=>this.renderSavedStories()))}setupNavigation(){window.addEventListener("hashchange",(()=>{this.updateActiveNavLink(),this.updateNavbar()})),this.updateActiveNavLink(),this.updateNavbar()}setupAuthCheck(){window.addEventListener("hashchange",(()=>{const e=this.router.getCurrentRoute();["/add","/favorites","/saved"].includes(e)&&!k.isAuthenticated()&&this.router.navigate("/login")}))}setupSkipToContent(){const e=document.getElementById("skip-link"),n=document.getElementById("main-content");e&&n&&e.addEventListener("click",(e=>{e.preventDefault(),n.focus()}))}updateNavbar(){const e=k.isAuthenticated(),n=document.querySelector(".nav-menu"),t=k.getUserInfo();n.innerHTML=e&&t?`\n        <li><a href="#/home" class="nav-link">Home</a></li>\n        <li><a href="#/add" class="nav-link">Add Story</a></li>\n        <li><a href="#/favorites" class="nav-link">Favorites</a></li>\n        <li><a href="#/saved" class="nav-link">Saved Stories</a></li>\n        <li class="user-menu">\n          <span class="user-name">Hello, ${t.name}</span>\n          <button class="btn btn-secondary btn-small" onclick="window.app.logout()">Logout</button>\n        </li>\n      `:'\n        <li><a href="#/home" class="nav-link">Home</a></li>\n        <li><a href="#/login" class="nav-link">Login</a></li>\n        <li><a href="#/register" class="nav-link">Register</a></li>\n      '}updateActiveNavLink(){const e=this.router.getCurrentRoute();document.querySelectorAll(".nav-link").forEach((n=>{n.getAttribute("href")===`#${e}`?(n.classList.add("active"),n.setAttribute("aria-current","page")):(n.classList.remove("active"),n.removeAttribute("aria-current"))}))}renderHome(){this.destroyCurrentView(),this.currentView=new F,this.currentView.render()}renderAddStory(){k.isAuthenticated()?(this.destroyCurrentView(),this.currentView=new C(this.router),this.currentView.render()):this.router.navigate("/login")}renderLogin(){k.isAuthenticated()?this.router.navigate("/home"):(this.destroyCurrentView(),this.currentView=new D(this.router),this.currentView.render())}renderRegister(){k.isAuthenticated()?this.router.navigate("/home"):(this.destroyCurrentView(),this.currentView=new z(this.router),this.currentView.render())}renderFavorites(){k.isAuthenticated()?(this.destroyCurrentView(),this.currentView=new $,this.currentView.render()):this.router.navigate("/login")}renderSavedStories(){k.isAuthenticated()?(this.destroyCurrentView(),this.currentView=new R,this.currentView.render()):this.router.navigate("/login")}async logout(){try{await M.unsubscribeFromPushNotifications()}catch(e){console.error("Error unsubscribing from push notifications:",e)}k.logout(),this.updateNavbar(),this.router.navigate("/login")}destroyCurrentView(){this.currentView&&"function"==typeof this.currentView.destroy&&(this.currentView.destroy(),this.currentView=null)}}document.addEventListener("DOMContentLoaded",(()=>{console.log("App initializing..."),window.app=new j})),window.addEventListener("beforeunload",(()=>{document.querySelectorAll("video").forEach((e=>{e.srcObject&&e.srcObject.getTracks().forEach((e=>e.stop()))}))}))})();