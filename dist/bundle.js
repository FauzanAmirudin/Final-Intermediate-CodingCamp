(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,r=0;r<e.length;r++)if(e[r].identifier===n){t=r;break}return t}function r(n,r){for(var i={},a=[],s=0;s<n.length;s++){var l=n[s],d=r.base?l[0]+r.base:l[0],c=i[d]||0,m="".concat(d," ").concat(c);i[d]=c+1;var p=t(m),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(h);else{var u=o(h,r);r.byIndex=s,e.splice(s,0,{identifier:m,updater:u,references:1})}a.push(m)}return a}function o(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,o){var i=r(n=n||[],o=o||{});return function(n){n=n||[];for(var a=0;a<i.length;a++){var s=t(i[a]);e[s].references--}for(var l=r(n,o),d=0;d<i.length;d++){var c=t(i[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=l}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},159:(n,e,t)=>{t.d(e,{A:()=>s});var r=t(601),o=t.n(r),i=t(314),a=t.n(i)()(o());a.push([n.id,'* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n  line-height: 1.6;\n  color: #333;\n  background-color: #f4f4f4;\n}\n\n/* Skip Link */\n.skip-link {\n  position: absolute;\n  top: -100px;\n  left: 0;\n  background: #2c3e50;\n  color: white;\n  padding: 8px;\n  z-index: 9999;\n  text-decoration: none;\n  transition: top 0.3s;\n  border: none;\n  font-family: inherit;\n  font-size: 1rem;\n  cursor: pointer;\n}\n\n.skip-link:focus {\n  top: 0;\n  outline: none;\n}\n\n/* Navigation */\n.navbar {\n  background: #2c3e50;\n  color: white;\n  padding: 1rem 0;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.nav-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.nav-title {\n  font-size: 1.8rem;\n  font-weight: bold;\n  color: #ecf0f1;\n}\n\n.nav-menu {\n  display: flex;\n  list-style: none;\n  gap: 1rem;\n}\n\n.nav-link {\n  color: #ecf0f1;\n  text-decoration: none;\n  padding: 0.75rem 1.5rem;\n  border-radius: 6px;\n  transition: all 0.3s ease;\n  font-weight: 500;\n}\n\n.nav-link:hover,\n.nav-link:focus {\n  background-color: #34495e;\n  transform: translateY(-2px);\n}\n\n.nav-link.active {\n  background-color: #3498db;\n  font-weight: bold;\n}\n\n/* Main Content */\n.main-content {\n  min-height: calc(100vh - 140px);\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 2rem;\n}\n\n/* Page Transitions */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.page {\n  animation: fadeIn 0.5s ease-in-out;\n}\n\n/* Hero Section */\n.hero {\n  text-align: center;\n  padding: 3rem 0;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border-radius: 12px;\n  margin-bottom: 3rem;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.hero h1 {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  font-weight: bold;\n}\n\n.hero p {\n  font-size: 1.2rem;\n  opacity: 0.9;\n}\n\n/* Stories Section */\n.stories-section h2 {\n  font-size: 2rem;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  text-align: center;\n}\n\n/* Stories Header */\n.stories-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 2rem;\n}\n\n.stories-header h2 {\n  margin-bottom: 0;\n  margin-right: 1rem;\n}\n\n/* Story List */\n.story-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n  gap: 2rem;\n  margin-bottom: 3rem;\n}\n\n.story-card {\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n  transition: all 0.3s ease;\n  border: 1px solid #e1e8ed;\n}\n\n.story-card:hover {\n  transform: translateY(-8px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n}\n\n.story-image {\n  width: 100%;\n  height: 220px;\n  object-fit: cover;\n  transition: transform 0.3s ease;\n}\n\n.story-card:hover .story-image {\n  transform: scale(1.05);\n}\n\n.story-content {\n  padding: 1.5rem;\n}\n\n.story-title {\n  font-size: 1.3rem;\n  font-weight: bold;\n  margin-bottom: 0.75rem;\n  color: #2c3e50;\n  line-height: 1.3;\n}\n\n.story-description {\n  color: #666;\n  margin-bottom: 1.5rem;\n  line-height: 1.6;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.story-meta {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 0.9rem;\n  padding-top: 1rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n.story-author {\n  font-weight: bold;\n  color: #3498db;\n}\n\n.story-date {\n  color: #999;\n}\n\n/* Form Styles */\n.add-story-section h1 {\n  text-align: center;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  font-size: 2.5rem;\n}\n\n.form-container {\n  background: white;\n  padding: 2.5rem;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n  max-width: 700px;\n  margin: 0 auto;\n}\n\n.form-group {\n  margin-bottom: 2rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.75rem;\n  font-weight: 600;\n  color: #2c3e50;\n  font-size: 1.1rem;\n}\n\n.form-input,\n.form-textarea {\n  width: 100%;\n  padding: 1rem;\n  border: 2px solid #e1e8ed;\n  border-radius: 8px;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n  font-family: inherit;\n}\n\n.form-input:focus,\n.form-textarea:focus {\n  outline: none;\n  border-color: #3498db;\n  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);\n}\n\n.form-textarea {\n  resize: vertical;\n  min-height: 120px;\n}\n\n.form-help {\n  color: #666;\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n  display: block;\n}\n\n/* Form Validation */\n.form-input.error,\n.form-textarea.error {\n  border-color: #e74c3c;\n  box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);\n}\n\n.form-error {\n  color: #e74c3c;\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n  display: none;\n  font-weight: 500;\n}\n\n.form-message {\n  padding: 1rem;\n  border-radius: 8px;\n  margin-top: 1.5rem;\n  text-align: center;\n  font-weight: 500;\n}\n\n.form-message.error {\n  background-color: #fee;\n  color: #e74c3c;\n  border: 1px solid #fcc;\n}\n\n.form-message.success {\n  background-color: #efe;\n  color: #27ae60;\n  border: 1px solid #cfc;\n}\n\n.form-message.loading {\n  background-color: #eef;\n  color: #3498db;\n  border: 1px solid #ccf;\n}\n\n/* Camera */\n.camera-container {\n  text-align: center;\n  padding: 1.5rem;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  background-color: #fafafa;\n}\n\n.camera-video,\n.camera-preview {\n  width: 100%;\n  max-width: 400px;\n  border-radius: 8px;\n  margin-bottom: 1rem;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n}\n\n.camera-controls {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n/* Buttons */\n.btn {\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 8px;\n  font-size: 1rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  text-decoration: none;\n  display: inline-block;\n  text-align: center;\n  min-width: 120px;\n}\n\n.btn:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.btn:active {\n  transform: translateY(0);\n}\n\n.btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.btn-primary {\n  background: linear-gradient(135deg, #3498db, #2980b9);\n  color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n  background: linear-gradient(135deg, #2980b9, #1f5f8b);\n}\n\n.btn-success {\n  background: linear-gradient(135deg, #27ae60, #229954);\n  color: white;\n}\n\n.btn-success:hover:not(:disabled) {\n  background: linear-gradient(135deg, #229954, #1e7e34);\n}\n\n.btn-secondary {\n  background: linear-gradient(135deg, #95a5a6, #7f8c8d);\n  color: white;\n}\n\n.btn-secondary:hover:not(:disabled) {\n  background: linear-gradient(135deg, #7f8c8d, #6c7b7d);\n}\n\n.btn-loading {\n  display: none;\n}\n\n/* Form Actions */\n.form-actions {\n  display: flex;\n  gap: 1rem;\n  justify-content: center;\n  margin-top: 2.5rem;\n  padding-top: 2rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n/* Map */\n.map-container {\n  height: 350px;\n  width: 100%;\n  border-radius: 8px;\n  overflow: hidden;\n  margin-bottom: 1rem;\n  border: 2px solid #e1e8ed;\n}\n\n.location-info {\n  background: #f8f9fa;\n  padding: 0.75rem;\n  border-radius: 6px;\n  margin-top: 0.75rem;\n  font-family: "Courier New", monospace;\n  font-size: 0.9rem;\n  color: #495057;\n  border: 1px solid #dee2e6;\n}\n\n/* Map Section */\n.map-section {\n  margin-top: 4rem;\n  padding: 2.5rem;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n}\n\n.map-section h3 {\n  margin-bottom: 1.5rem;\n  color: #2c3e50;\n  font-size: 1.8rem;\n  text-align: center;\n}\n\n/* Map Popup */\n.map-popup h4 {\n  margin: 0 0 0.5rem 0;\n  color: #2c3e50;\n  font-size: 1.1rem;\n}\n\n.map-popup p {\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n  color: #555;\n}\n\n.map-popup small {\n  color: #888;\n  font-style: italic;\n}\n\n/* Loading */\n.loading {\n  text-align: center;\n  padding: 3rem;\n  font-size: 1.2rem;\n  color: #666;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n/* Error */\n.error {\n  background-color: #fee;\n  color: #e74c3c;\n  padding: 1.5rem;\n  border-radius: 8px;\n  margin: 1rem 0;\n  text-align: center;\n  border: 1px solid #fcc;\n}\n\n/* Success */\n.success {\n  background-color: #efe;\n  color: #27ae60;\n  padding: 1.5rem;\n  border-radius: 8px;\n  margin: 1rem 0;\n  text-align: center;\n  border: 1px solid #cfc;\n}\n\n/* No Stories */\n.no-stories {\n  text-align: center;\n  color: #666;\n  font-style: italic;\n  padding: 3rem;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n/* Footer */\n.footer {\n  background: #2c3e50;\n  color: #ecf0f1;\n  text-align: center;\n  padding: 1.5rem;\n  margin-top: 3rem;\n}\n\n/* View Transition API */\n@view-transition {\n  navigation: auto;\n}\n\n::view-transition-old(root),\n::view-transition-new(root) {\n  animation-duration: 0.4s;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .nav-container {\n    flex-direction: column;\n    gap: 1rem;\n    padding: 0 1rem;\n  }\n\n  .nav-menu {\n    gap: 0.5rem;\n  }\n\n  .main-content {\n    padding: 1rem;\n  }\n\n  .hero {\n    padding: 2rem 1rem;\n    margin-bottom: 2rem;\n  }\n\n  .hero h1 {\n    font-size: 2rem;\n  }\n\n  .story-list {\n    grid-template-columns: 1fr;\n    gap: 1.5rem;\n  }\n\n  .form-container {\n    margin: 0 1rem;\n    padding: 1.5rem;\n  }\n\n  .form-actions {\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .camera-controls {\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .story-meta {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5rem;\n  }\n\n  .map-section {\n    padding: 1.5rem;\n    margin-top: 2rem;\n  }\n\n  .stories-header {\n    flex-direction: column;\n    gap: 1rem;\n  }\n\n  .stories-header h2 {\n    margin-right: 0;\n  }\n}\n\n@media (max-width: 480px) {\n  .hero h1 {\n    font-size: 1.5rem;\n  }\n\n  .hero p {\n    font-size: 1rem;\n  }\n\n  .nav-title {\n    font-size: 1.5rem;\n  }\n\n  .story-card {\n    margin: 0 0.5rem;\n  }\n\n  .btn {\n    width: 100%;\n    max-width: 200px;\n  }\n}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: #f1f1f1;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #c1c1c1;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #a1a1a1;\n}\n\n/* Focus styles for accessibility */\n.btn:focus,\n.form-input:focus,\n.form-textarea:focus,\n.nav-link:focus {\n  outline: 2px solid #3498db;\n  outline-offset: 2px;\n}\n\n/* Print styles */\n@media print {\n  .navbar,\n  .footer,\n  .btn,\n  .camera-container,\n  .map-container {\n    display: none;\n  }\n\n  .story-list {\n    grid-template-columns: 1fr;\n  }\n\n  .story-card {\n    break-inside: avoid;\n    margin-bottom: 1rem;\n  }\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Loading Spinner */\n.loading-spinner {\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  border: 3px solid #f3f3f3;\n  border-top: 3px solid #3498db;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-right: 8px;\n}\n\n.loading-spinner.small {\n  width: 16px;\n  height: 16px;\n  border-width: 2px;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Loading container */\n.loading {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 3rem;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.loading .loading-spinner {\n  width: 40px;\n  height: 40px;\n  border-width: 4px;\n  margin-bottom: 1rem;\n}\n\n/* Error actions */\n.error-actions {\n  margin-top: 1rem;\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n\n/* Button loading state */\n.btn-loading {\n  display: none;\n  align-items: center;\n}\n\n/* No stories styling */\n.no-stories {\n  text-align: center;\n  padding: 3rem;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n}\n\n.no-stories h3 {\n  color: #2c3e50;\n  margin-bottom: 1rem;\n  font-size: 1.5rem;\n}\n\n.no-stories p {\n  color: #666;\n  margin-bottom: 2rem;\n  font-size: 1.1rem;\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Auth Section */\n.auth-section {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 60vh;\n  padding: 2rem;\n}\n\n.auth-container {\n  width: 100%;\n  max-width: 450px;\n}\n\n.auth-container h1 {\n  text-align: center;\n  margin-bottom: 2rem;\n  color: #2c3e50;\n  font-size: 2rem;\n}\n\n.auth-switch {\n  text-align: center;\n  margin-top: 1.5rem;\n  padding-top: 1.5rem;\n  border-top: 1px solid #e1e8ed;\n}\n\n.auth-switch p {\n  color: #666;\n}\n\n.link {\n  color: #3498db;\n  text-decoration: none;\n  font-weight: 500;\n}\n\n.link:hover {\n  text-decoration: underline;\n}\n\n/* Demo Credentials */\n.demo-credentials {\n  background: #f8f9fa;\n  padding: 1rem;\n  border-radius: 6px;\n  margin: 1rem 0;\n  border-left: 4px solid #3498db;\n}\n\n.demo-credentials p {\n  margin: 0.25rem 0;\n  font-family: monospace;\n  font-size: 0.9rem;\n}\n\n/* User Menu */\n.user-menu {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.user-name {\n  color: #ecf0f1;\n  font-weight: 500;\n}\n\n.btn-small {\n  padding: 0.5rem 1rem;\n  font-size: 0.9rem;\n}\n\n/* Responsive Auth */\n@media (max-width: 768px) {\n  .auth-section {\n    padding: 1rem;\n  }\n\n  .auth-container {\n    max-width: 100%;\n  }\n\n  .user-menu {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n}\n\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Story location info */\n.story-location {\n  font-size: 0.8rem;\n  color: #666;\n  margin-top: 0.25rem;\n}\n\n/* Map no data */\n.map-no-data {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #f8f9fa;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  color: #666;\n  font-style: italic;\n}\n\n/* Map popup improvements */\n.map-popup {\n  max-width: 250px;\n}\n\n.map-popup h4 {\n  margin: 0 0 0.5rem 0;\n  color: #2c3e50;\n  font-size: 1rem;\n}\n\n.map-popup p {\n  margin: 0 0 0.5rem 0;\n  line-height: 1.4;\n  color: #555;\n  font-size: 0.9rem;\n}\n\n.map-popup small {\n  color: #888;\n  font-size: 0.8rem;\n  display: block;\n  margin-bottom: 0.25rem;\n}\n\n/* Story card improvements */\n.story-meta {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid #e1e8ed;\n  font-size: 0.875rem;\n}\n\n.story-meta p {\n  margin: 0;\n}\n\n.story-author {\n  font-weight: bold;\n  color: #3498db;\n}\n\n.story-date {\n  color: #999;\n}\n\n/* Responsive updates */\n@media (max-width: 768px) {\n  .story-meta {\n    font-size: 0.8rem;\n  }\n\n  .map-popup {\n    max-width: 200px;\n  }\n\n  .map-popup h4 {\n    font-size: 0.9rem;\n  }\n\n  .map-popup p {\n    font-size: 0.8rem;\n  }\n}\n/* Tambahkan ke CSS yang sudah ada */\n\n/* Map error styling */\n.map-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #fee;\n  border: 2px dashed #e74c3c;\n  border-radius: 8px;\n  color: #e74c3c;\n  text-align: center;\n}\n\n.map-error p {\n  margin: 0 0 0.5rem 0;\n  font-weight: bold;\n}\n\n.map-error small {\n  color: #c0392b;\n  font-style: italic;\n}\n\n/* Map no data improvements */\n.map-no-data {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 300px;\n  background: #f8f9fa;\n  border: 2px dashed #ddd;\n  border-radius: 8px;\n  color: #666;\n  text-align: center;\n}\n\n.map-no-data p {\n  margin: 0 0 0.5rem 0;\n  font-weight: 500;\n}\n\n.map-no-data small {\n  color: #999;\n  font-style: italic;\n}\n',""]);const s=a},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",r=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),r&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),r&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,r,o,i){"string"==typeof n&&(n=[[null,n,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var d=0;d<n.length;d++){var c=[].concat(n[d]);r&&a[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var r=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var o=void 0!==t.layer;o&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,o&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var i=t.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,exports:{}};return n[r](i,i.exports,t),i.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var r=t(72),o=t.n(r),i=t(825),a=t.n(i),s=t(659),l=t.n(s),d=t(56),c=t.n(d),m=t(540),p=t.n(m),h=t(113),u=t.n(h),g=t(159),f={};f.styleTagTransform=u(),f.setAttributes=c(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=p(),o()(g.A,f),g.A&&g.A.locals&&g.A.locals;class y{constructor(){this.routes={},this.currentRoute=null,this.init()}init(){window.addEventListener("hashchange",(()=>this.handleRoute())),window.addEventListener("load",(()=>this.handleRoute()))}addRoute(n,e){this.routes[n]=e}handleRoute(){const n=window.location.hash.slice(1)||"/home",e=this.routes[n]||this.routes["/home"];e&&"function"==typeof e&&(document.startViewTransition?document.startViewTransition((()=>{e()})):e())}navigate(n){window.location.hash=n}getCurrentRoute(){return window.location.hash.slice(1)||"/home"}}const b="https://story-api.dicoding.dev/v1",v=-6.2,w=106.816666,x=10;class k{constructor(n,e={}){this.containerId=n,this.options={clickable:!1,showPopup:!0,center:[v,w],zoom:x,...e},this.map=null,this.markers=[],this.selectedLocation=null,this.selectionMarker=null}init(){this.createMap(),this.options.clickable&&this.enableLocationSelection()}createMap(){this.map=L.map(this.containerId).setView(this.options.center,this.options.zoom),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(this.map)}enableLocationSelection(){this.map.on("click",(n=>{this.selectLocation(n.latlng)}))}selectLocation(n){const{lat:e,lng:t}=n;this.clearSelectionMarker(),this.selectionMarker=L.marker([e,t]).addTo(this.map),this.options.showPopup&&this.selectionMarker.bindPopup("Selected location").openPopup(),this.selectedLocation={lat:e,lng:t},this.options.onLocationSelect&&this.options.onLocationSelect(e,t)}addMarker(n,e,t="",r={}){const o=L.marker([n,e],r).addTo(this.map);return t&&o.bindPopup(t),this.markers.push(o),o}addMultipleMarkers(n){if(n.forEach((n=>{n.lat&&n.lng&&this.addMarker(n.lat,n.lng,n.popup||"",n.options||{})})),this.markers.length>0){const n=new L.featureGroup(this.markers);this.map.fitBounds(n.getBounds().pad(.1))}}clearSelectionMarker(){this.selectionMarker&&(this.map.removeLayer(this.selectionMarker),this.selectionMarker=null)}getSelectedLocation(){return this.selectedLocation}destroy(){this.map&&(this.map.remove(),this.map=null)}}class E{static setToken(n){localStorage.setItem("authToken",n)}static getToken(){return localStorage.getItem("authToken")}static removeToken(){localStorage.removeItem("authToken"),localStorage.removeItem("userInfo")}static setUserInfo(n){localStorage.setItem("userInfo",JSON.stringify(n))}static getUserInfo(){const n=localStorage.getItem("userInfo");return n?JSON.parse(n):null}static isAuthenticated(){return!!this.getToken()}static logout(){this.removeToken(),window.location.hash="/login"}}class S extends Error{constructor(n,e=null,t=!1){super(n),this.name="ApiError",this.status=e,this.isNetworkError=t}static handle(n){if(n instanceof S)switch(n.status){case 401:return"Session expired. Please login again.";case 403:return"You don't have permission to perform this action.";case 404:return"The requested resource was not found.";case 413:return"The file you're trying to upload is too large.";case 429:return"Too many requests. Please try again later.";case 500:return"Server error. Please try again later.";default:return n.isNetworkError?"Network error: Please check your internet connection.":n.message||"An unexpected error occurred."}return n.message||"An unexpected error occurred."}static isNetworkError(n){return"TypeError"===n.name&&(n.message.includes("fetch")||n.message.includes("network")||n.message.includes("Failed to fetch"))}}class I{static getAuthHeaders(){const n=E.getToken();return n?{Authorization:`Bearer ${n}`,Accept:"application/json"}:{Accept:"application/json"}}static async getAllStories(n=1,e=20,t=1){try{const r=new URLSearchParams({page:n.toString(),size:e.toString(),location:t.toString()}),o=`${b}/stories?${r}`;console.log("Fetching stories from:",o);const i=await fetch(o,{method:"GET",headers:this.getAuthHeaders()});if(!i.ok)throw new S("Failed to fetch stories",i.status);return await i.json()}catch(n){if(console.error("Error in getAllStories:",n),S.isNetworkError(n))throw new S("Failed to connect to the server",null,!0);if(n instanceof S)throw n;throw new S(n.message)}}static async getStoryDetail(n){try{console.log("Fetching story detail for ID:",n);const e=await fetch(`${b}/stories/${n}`,{method:"GET",headers:this.getAuthHeaders()});if(console.log("Story detail response status:",e.status),!e.ok){const n=await e.text();if(console.error("Error response:",n),401===e.status)throw new Error("Authentication failed. Please login again.");throw new Error(`HTTP ${e.status}: ${n}`)}const t=await e.json();return console.log("Story detail received:",t),t}catch(n){if(console.error("Error in getStoryDetail:",n),"TypeError"===n.name&&n.message.includes("fetch"))throw new Error("Network error: Please check your internet connection");throw n}}static async addStory(n){try{console.log("Adding story..."),console.log("FormData contents:");for(let[e,t]of n.entries())"photo"===e?console.log(e,"- File size:",t.size,"bytes"):console.log(e,":",t);const e=await fetch(`${b}/stories`,{method:"POST",headers:{Authorization:`Bearer ${E.getToken()}`},body:n});if(!e.ok){const n=await e.json().catch((()=>({})));throw new S(n.message||"Failed to add story",e.status)}const t=await e.json();return console.log("Story added successfully:",t),t}catch(n){if(console.error("Error in addStory:",n),S.isNetworkError(n))throw new S("Failed to connect to the server",null,!0);if(n instanceof S)throw n;throw new S(n.message)}}static async register(n){try{console.log("Registering user:",n.email);const e=await fetch(`${b}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json();if(console.log("Register response:",t),!e.ok)throw new S(t.message||"Registration failed",e.status);return t}catch(n){if(console.error("Error in register:",n),S.isNetworkError(n))throw new S("Failed to connect to the server",null,!0);if(n instanceof S)throw n;throw new S(n.message)}}static async login(n){try{console.log("Logging in user:",n.email);const e=await fetch(`${b}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json();if(console.log("Login response:",t),!e.ok)throw new S(t.message||"Login failed",e.status);return!1===t.error&&t.loginResult&&t.loginResult.token&&(E.setToken(t.loginResult.token),E.setUserInfo({userId:t.loginResult.userId,name:t.loginResult.name,email:n.email})),t}catch(n){if(console.error("Error in login:",n),S.isNetworkError(n))throw new S("Failed to connect to the server",null,!0);if(n instanceof S)throw n;throw new S(n.message)}}}class A{constructor(n){this.view=n}async loadStories(){try{if(!this.view)return void console.error("View is not initialized");console.log("Loading matches...");const n=await I.getAllStories(1,20,1);if(!this.view.hideLoading)return void console.error("View method hideLoading not found");if(this.view.hideLoading(),!1!==n.error||!n.listStory)throw new S(n.message||"Failed to load matches",null);{const e=n.listStory;if(console.log("Matches count:",e.length),!this.view.renderStories||!this.view.showNoStories)return void console.error("Required view methods not found");0===e.length?this.view.showNoStories():(this.view.renderStories(e),this.view.renderStoriesMap&&setTimeout((()=>{this.view.renderStoriesMap(e)}),500))}}catch(n){console.error("Error loading matches:",n),this.view.hideLoading&&this.view.hideLoading();const e=n instanceof S?S.handle(n):"Failed to load matches. Please try again later.";this.view.showError&&this.view.showError(e,n instanceof S?n.status:"network"),n instanceof S&&401===n.status&&(E.logout(),setTimeout((()=>{window.location.hash="#/login"}),2e3))}}}class M{constructor(){this.presenter=new A(this)}async render(){const n=document.getElementById("page-container");if(!n)return void console.error("Page container not found");const e=E.isAuthenticated();n.innerHTML=`\n      <div class="page">\n        <section class="hero">\n          <h1>Welcome to Strory App</h1>\n          <p>Discover amazing Strory Appes from around the world</p>\n        </section>\n        <section class="stories-section">\n          <div class="stories-header">\n            <h2>Latest Storyes</h2>\n            ${e?'<a href="#/add" class="btn btn-primary">Add New Story</a>':'<a href="#/login" class="btn btn-primary">Login to Add Story</a>'}\n          </div>\n          <div class="loading" id="loading-indicator">\n            <div class="loading-spinner"></div>\n            <p>Loading Storyes...</p>\n          </div>\n          <div id="stories-container"></div>\n        </section>\n      </div>\n    `,document.getElementById("stories-container")?await this.presenter.loadStories():console.error("Stories container not found")}renderStories(n){const e=document.getElementById("stories-container");n&&0!==n.length?e.innerHTML=`\n      <div class="story-list">\n        ${n.map((n=>this.createStoryCard(n))).join("")}\n      </div>\n    `:e.innerHTML='\n        <div class="no-stories">\n          <h3>No stories available yet</h3>\n          <p>Be the first to share your story!</p>\n          <a href="#/add" class="btn btn-primary">Add Your Story</a>\n        </div>\n      '}createStoryCard(n){if(!n)return"";const e=n.id||"",t=n.name||"Anonymous",r=n.description||"No description available",o=n.photoUrl||"";let i="Unknown date";if(n.createdAt)try{i=new Date(n.createdAt).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){console.warn("Invalid date format:",n.createdAt),i=n.createdAt}return`\n      <article class="story-card" data-story-id="${e}">\n        <img src="${o}" \n             alt="Story photo by ${this.escapeHtml(t)}" \n             class="story-image" \n             loading="lazy"\n             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIG5vdCBhdmFpbGFibGU8L3RleHQ+PC9zdmc+'">\n        <div class="story-content">\n          <h3 class="story-title">${this.escapeHtml(t)}</h3>\n          <p class="story-description">${this.escapeHtml(r.length>150?r.substring(0,150)+"...":r)}</p>\n          <div class="story-meta">\n            <p class="story-author">By: ${this.escapeHtml(t)}</p>\n            <p class="story-date">📅 ${i}</p>\n            ${n.lat&&n.lon?`<p class="story-location">📍 ${parseFloat(n.lat).toFixed(4)}, ${parseFloat(n.lon).toFixed(4)}</p>`:""}\n          </div>\n        </div>\n      </article>\n    `}renderStoriesMap(n){const e=document.getElementById("stories-container");if(document.getElementById("stories-map"))return;const t=document.createElement("section");t.className="map-section",t.innerHTML='\n      <h2>Stories Around the World</h2>\n      <div id="stories-map" class="map-container"></div>\n    ',e.appendChild(t),setTimeout((()=>{try{const e=new k("stories-map",{clickable:!1,showPopup:!0,zoom:5});e.init();const t=n.filter((n=>n&&null!==n.lat&&void 0!==n.lat&&null!==n.lon&&void 0!==n.lon&&!isNaN(parseFloat(n.lat))&&!isNaN(parseFloat(n.lon))&&0!==parseFloat(n.lat)&&0!==parseFloat(n.lon))).map((n=>({lat:parseFloat(n.lat),lng:parseFloat(n.lon),popup:`\n              <div class="map-popup">\n                <h4>${this.escapeHtml(n.name||"Anonymous")}</h4>\n                <p>${this.escapeHtml((n.description||"").substring(0,100))}${(n.description||"").length>100?"...":""}</p>\n                <small>📅 ${n.createdAt?new Date(n.createdAt).toLocaleDateString("id-ID"):"Unknown date"}</small>\n                <br>\n                <small>📍 ${parseFloat(n.lat).toFixed(4)}, ${parseFloat(n.lon).toFixed(4)}</small>\n              </div>\n            `})));console.log("Story locations for map:",t),t.length>0?e.addMultipleMarkers(t):(console.warn("No valid story locations found for map"),document.getElementById("stories-map").innerHTML='\n            <div class="map-no-data">\n              <p>No location data available for stories</p>\n              <small>Stories need to have valid coordinates to appear on the map</small>\n            </div>\n          ')}catch(n){console.error("Error initializing map:",n);const e=document.querySelector(".map-section");e&&(e.innerHTML=`\n            <h2>Stories Around the World</h2>\n            <div class="map-error">\n              <p>Unable to load map</p>\n              <small>Error: ${n.message}</small>\n            </div>\n          `)}}),100)}hideLoading(){const n=document.getElementById("loading-indicator");n&&(n.style.display="none")}showNoStories(){const n=document.getElementById("stories-container"),e=E.isAuthenticated();n.innerHTML=`\n      <div class="no-stories">\n        <h3>No stories available yet</h3>\n        <p>Be the first to share your story!</p>\n        ${e?'<a href="#/add" class="btn btn-primary">Add Your Story</a>':'<a href="#/login" class="btn btn-primary">Login to Add Story</a>'}\n      </div>\n    `}showError(n,e="general"){const t=document.getElementById("stories-container");if(!t)return void console.error("Stories container not found when showing error");const r="auth"===e||401===e,o="network"===e;t.innerHTML=`\n      <div class="error">\n        <h3>Oops! Something went wrong</h3>\n        <p>${n}</p>\n        <div class="error-actions">\n          ${r?'<a href="#/login" class="btn btn-primary">Login</a>':'<button onclick="location.reload()" class="btn btn-primary">Try Again</button>'}\n          ${r||o?"":'<a href="#/add" class="btn btn-secondary">Add New Story</a>'}\n        </div>\n      </div>\n    `}escapeHtml(n){if(!n)return"";const e=document.createElement("div");return e.textContent=n.toString(),e.innerHTML}}class B{constructor(n){this.container=document.getElementById(n),this.stream=null,this.capturedBlob=null,this.init()}init(){this.createCameraElements(),this.bindEvents()}createCameraElements(){this.container.innerHTML='\n            <div class="camera-container">\n                <video id="camera-video" class="camera-video" autoplay style="display: none;"></video>\n                <canvas id="camera-canvas" style="display: none;"></canvas>\n                <img id="camera-preview" class="camera-preview" style="display: none;" alt="Captured photo preview">\n                <div class="camera-controls">\n                    <button type="button" id="start-camera" class="btn btn-primary">Start Camera</button>\n                    <button type="button" id="capture-photo" class="btn btn-success" style="display: none;">Capture Photo</button>\n                    <button type="button" id="retake-photo" class="btn btn-secondary" style="display: none;">Retake</button>\n                </div>\n            </div>\n        ',this.video=document.getElementById("camera-video"),this.canvas=document.getElementById("camera-canvas"),this.preview=document.getElementById("camera-preview"),this.startBtn=document.getElementById("start-camera"),this.captureBtn=document.getElementById("capture-photo"),this.retakeBtn=document.getElementById("retake-photo")}bindEvents(){this.startBtn.addEventListener("click",(()=>this.startCamera())),this.captureBtn.addEventListener("click",(()=>this.capturePhoto())),this.retakeBtn.addEventListener("click",(()=>this.retakePhoto()))}async startCamera(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480}}}),this.video.srcObject=this.stream,this.showElement(this.video),this.hideElement(this.startBtn),this.showElement(this.captureBtn)}catch(n){console.error("Error accessing camera:",n),this.showError("Error accessing camera: "+n.message)}}capturePhoto(){const n=this.canvas.getContext("2d");this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,n.drawImage(this.video,0,0),this.canvas.toBlob((n=>{this.capturedBlob=n;const e=URL.createObjectURL(n);this.preview.src=e,this.showElement(this.preview),this.hideElement(this.video),this.hideElement(this.captureBtn),this.showElement(this.retakeBtn),this.stopCamera()}),"image/jpeg",.8)}retakePhoto(){this.hideElement(this.preview),this.hideElement(this.retakeBtn),this.showElement(this.startBtn),this.capturedBlob=null,this.preview.src&&URL.revokeObjectURL(this.preview.src)}stopCamera(){this.stream&&(this.stream.getTracks().forEach((n=>n.stop())),this.stream=null)}getCapturedPhoto(){return this.capturedBlob}showElement(n){n.style.display="block"}hideElement(n){n.style.display="none"}showError(n){const e=document.createElement("div");e.className="error",e.textContent=n,this.container.appendChild(e),setTimeout((()=>{e.remove()}),5e3)}destroy(){this.stopCamera(),this.preview&&this.preview.src&&URL.revokeObjectURL(this.preview.src)}}class T{constructor(n,e){this.view=n,this.router=e}async addStory(n){try{console.log("Submitting story...");const e=await I.addStory(n);return!1===e.error?(this.view.showMessage("Story added successfully! Redirecting...","success"),setTimeout((()=>{this.router.navigate("/home")}),2e3)):this.view.showMessage(e.message||"Failed to add story","error"),e}catch(n){console.error("Error adding story:",n);const e=n instanceof S?S.handle(n):n.message||"Failed to add story. Please try again.";throw this.view.showMessage(e,"error"),n}}validateForm(n,e,t){let r=!0;return n?n.length<10?(this.view.showError("description-error","Description must be at least 10 characters"),r=!1):n.length>1e3?(this.view.showError("description-error","Description must not exceed 1000 characters"),r=!1):this.view.clearError("description-error"):(this.view.showError("description-error","Description is required"),r=!1),e?e.size>5242880?(this.view.showError("photo-error","Photo size must be less than 5MB"),r=!1):this.view.clearError("photo-error"):(this.view.showError("photo-error","Please capture a photo"),r=!1),t?this.view.clearError("location-error"):(this.view.showError("location-error","Please select a location"),r=!1),r}}class C{constructor(n){this.router=n,this.presenter=new T(this,n),this.camera=null,this.map=null,this.selectedLocation=null}render(){document.getElementById("page-container").innerHTML='\n      <div class="page">\n        <h2 tabindex="-1" id="add-story-heading">Add New Story</h2>\n        <section class="add-story-section">\n          <form id="add-story-form" class="form-container" novalidate>\n            <div class="form-group">\n              <label for="story-description" class="form-label">Description *</label>\n              <textarea id="story-description" \n                name="description" \n                class="form-textarea" \n                required\n                placeholder="Tell your story..."\n                maxlength="1000"></textarea>\n              <small class="form-help">Maximum 1000 characters</small>\n              <div class="form-error" id="description-error"></div>\n            </div>\n            \n            <div class="form-group">\n              <label class="form-label">Photo *</label>\n              <div id="camera-container"></div>\n              <div class="form-error" id="photo-error"></div>\n            </div>\n            \n            <div class="form-group">\n              <label class="form-label">Location *</label>\n              <p class="form-help">Click on the map to select your story location</p>\n              <div id="location-map" class="map-container"></div>\n              <input type="hidden" id="latitude" name="lat">\n              <input type="hidden" id="longitude" name="lon">\n              <p id="location-info" class="location-info">No location selected</p>\n              <div class="form-error" id="location-error"></div>\n            </div>\n            \n            <div class="form-actions">\n              <button type="submit" class="btn btn-primary" id="submit-btn">\n                <span class="btn-text">Add Story</span>\n                <span class="btn-loading" style="display: none;">\n                  <span class="loading-spinner small"></span>\n                  Adding...\n                </span>\n              </button>\n              <button type="button" class="btn btn-secondary" onclick="history.back()">Cancel</button>\n            </div>\n            \n            <div id="form-message"></div>\n          </form>\n        </section>\n      </div>\n    ',setTimeout((()=>{this.initializeComponents(),this.initializeForm();const n=document.getElementById("add-story-heading");n&&n.focus()}),100)}initializeComponents(){try{this.camera=new B("camera-container"),this.map=new k("location-map",{clickable:!0,showPopup:!0,onLocationSelect:(n,e)=>this.onLocationSelect(n,e)}),this.map.init()}catch(n){console.error("Error initializing components:",n),this.showMessage("Error initializing components. Please refresh the page.","error")}}onLocationSelect(n,e){this.selectedLocation={lat:n,lng:e},document.getElementById("latitude").value=n,document.getElementById("longitude").value=e,document.getElementById("location-info").textContent=`Selected: ${n.toFixed(6)}, ${e.toFixed(6)}`,this.clearError("location-error")}initializeForm(){document.getElementById("add-story-form").addEventListener("submit",(n=>this.handleSubmit(n)))}async handleSubmit(n){n.preventDefault();const e=document.getElementById("story-description").value.trim(),t=this.camera?.getCapturedPhoto();if(!this.presenter.validateForm(e,t,this.selectedLocation))return void this.showMessage("Please fill all required fields","error");const r=document.getElementById("submit-btn"),o=r.querySelector(".btn-text"),i=r.querySelector(".btn-loading");r.disabled=!0,o.style.display="none",i.style.display="inline-flex";try{const n=this.prepareFormData();await this.presenter.addStory(n)}catch(n){console.error("Error submitting story:",n)}finally{r.disabled=!1,o.style.display="inline",i.style.display="none"}}prepareFormData(){const n=new FormData,e=document.getElementById("story-description").value.trim(),t=this.camera.getCapturedPhoto(),{lat:r,lng:o}=this.selectedLocation;if(!(e&&t&&r&&o))throw new Error("All fields are required");if(!(t instanceof Blob))throw new Error("Invalid photo format");if(isNaN(r)||isNaN(o))throw new Error("Invalid location coordinates");return n.append("description",e),n.append("photo",t,`story-${Date.now()}.jpg`),n.append("lat",parseFloat(r).toString()),n.append("lon",parseFloat(o).toString()),n}showMessage(n,e){const t=document.getElementById("form-message");t.className=`form-message ${e}`,t.textContent=n,t.scrollIntoView({behavior:"smooth",block:"nearest"})}showError(n,e){const t=document.getElementById(n);t&&(t.textContent=e,t.style.display="block")}clearError(n){const e=document.getElementById(n);e&&(e.textContent="",e.style.display="none")}destroy(){try{this.camera&&this.camera.destroy(),this.map&&this.map.destroy()}catch(n){console.error("Error destroying view:",n)}}}class z{constructor(n){this.router=n}render(){document.getElementById("page-container").innerHTML='\n            <div class="page">\n                <section class="auth-section">\n                    <div class="auth-container">\n                        <h1>Login to Story App</h1>\n                        <form id="login-form" class="form-container">\n                            <div class="form-group">\n                                <label for="login-email" class="form-label">Email *</label>\n                                <input type="email" \n                                       id="login-email" \n                                       name="email" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your email">\n                                <div class="form-error" id="email-error"></div>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="login-password" class="form-label">Password *</label>\n                                <input type="password" \n                                       id="login-password" \n                                       name="password" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your password">\n                                <div class="form-error" id="password-error"></div>\n                            </div>\n                            \n                            <div class="form-actions">\n                                <button type="submit" class="btn btn-primary" id="login-btn">\n                                    <span class="btn-text">Login</span>\n                                    <span class="btn-loading" style="display: none;">\n                                        <span class="loading-spinner small"></span>\n                                        Logging in...\n                                    </span>\n                                </button>\n                            </div>\n                            \n                            <div id="login-message"></div>\n                        </form>\n                        \n                        <div class="auth-switch">\n                            <p>Don\'t have an account? <a href="#/register" class="link">Register here</a></p>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        ',this.initializeForm()}initializeForm(){document.getElementById("login-form").addEventListener("submit",(n=>this.handleLogin(n)))}async handleLogin(n){n.preventDefault();const e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value;if(!e||!t)return void this.showMessage("Please fill in all fields","error");const r=document.getElementById("login-btn"),o=r.querySelector(".btn-text"),i=r.querySelector(".btn-loading");r.disabled=!0,o.style.display="none",i.style.display="inline-flex";try{const n=await I.login({email:e,password:t});!1===n.error&&n.loginResult?(this.showMessage("Login successful! Redirecting...","success"),setTimeout((()=>{this.router.navigate("/home"),window.app&&window.app.updateNavbar&&window.app.updateNavbar()}),1500)):this.showMessage(n.message||"Login failed","error")}catch(n){console.error("Login error:",n),this.showMessage(n.message||"Login failed","error")}finally{r.disabled=!1,o.style.display="inline",i.style.display="none"}}showMessage(n,e){const t=document.getElementById("login-message");t.className=`form-message ${e}`,t.textContent=n}}class N{constructor(n){this.router=n}render(){document.getElementById("page-container").innerHTML='\n            <div class="page">\n                <section class="auth-section">\n                    <div class="auth-container">\n                        <h1>Register to Story App</h1>\n                        <form id="register-form" class="form-container">\n                            <div class="form-group">\n                                <label for="register-name" class="form-label">Full Name *</label>\n                                <input type="text" \n                                       id="register-name" \n                                       name="name" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your full name">\n                                <div class="form-error" id="name-error"></div>\n                            </div>\n\n                            <div class="form-group">\n                                <label for="register-email" class="form-label">Email *</label>\n                                <input type="email" \n                                       id="register-email" \n                                       name="email" \n                                       class="form-input" \n                                       required\n                                       placeholder="Enter your email">\n                                <div class="form-error" id="email-error"></div>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="register-password" class="form-label">Password *</label>\n                                <input type="password" \n                                       id="register-password" \n                                       name="password" \n                                       class="form-input" \n                                       required\n                                       minlength="8"\n                                       placeholder="Minimum 8 characters">\n                                <small class="form-help">Password must be at least 8 characters</small>\n                                <div class="form-error" id="password-error"></div>\n                            </div>\n                            \n                            <div class="form-actions">\n                                <button type="submit" class="btn btn-primary" id="register-btn">\n                                    <span class="btn-text">Register</span>\n                                    <span class="btn-loading" style="display: none;">\n                                        <span class="loading-spinner small"></span>\n                                        Creating account...\n                                    </span>\n                                </button>\n                            </div>\n                            \n                            <div id="register-message"></div>\n                        </form>\n                        \n                        <div class="auth-switch">\n                            <p>Already have an account? <a href="#/login" class="link">Login here</a></p>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        ',this.initializeForm()}initializeForm(){document.getElementById("register-form").addEventListener("submit",(n=>this.handleRegister(n)))}async handleRegister(n){n.preventDefault();const e=document.getElementById("register-name").value.trim(),t=document.getElementById("register-email").value.trim(),r=document.getElementById("register-password").value;if(!e||!t||!r)return void this.showMessage("Please fill in all fields","error");if(r.length<8)return void this.showMessage("Password must be at least 8 characters","error");const o=document.getElementById("register-btn"),i=o.querySelector(".btn-text"),a=o.querySelector(".btn-loading");o.disabled=!0,i.style.display="none",a.style.display="inline-flex";try{const n=await I.register({name:e,email:t,password:r});!1===n.error?(this.showMessage("Registration successful! Please login to continue.","success"),setTimeout((()=>{this.router.navigate("/login")}),2e3)):this.showMessage(n.message||"Registration failed","error")}catch(n){console.error("Registration error:",n),this.showMessage(n.message||"Registration failed","error")}finally{o.disabled=!1,i.style.display="inline",a.style.display="none"}}showMessage(n,e){const t=document.getElementById("register-message");t.className=`form-message ${e}`,t.textContent=n}}class P{constructor(){this.router=new y,this.currentView=null,this.init(),this.setupSkipToContent()}init(){this.setupRoutes(),this.setupNavigation(),this.setupAuthCheck(),window.addEventListener("unhandledrejection",(n=>{console.error("Unhandled promise rejection:",n.reason)})),this.router.handleRoute()}setupRoutes(){this.router.addRoute("/home",(()=>this.renderHome())),this.router.addRoute("/add",(()=>this.renderAddStory())),this.router.addRoute("/login",(()=>this.renderLogin())),this.router.addRoute("/register",(()=>this.renderRegister()))}setupNavigation(){window.addEventListener("hashchange",(()=>{this.updateActiveNavLink(),this.updateNavbar()})),this.updateActiveNavLink(),this.updateNavbar()}setupAuthCheck(){window.addEventListener("hashchange",(()=>{const n=this.router.getCurrentRoute();["/add"].includes(n)&&!E.isAuthenticated()&&this.router.navigate("/login")}))}setupSkipToContent(){const n=document.getElementById("skip-link"),e=document.getElementById("main-content");n&&e&&n.addEventListener("click",(n=>{n.preventDefault(),e.focus()}))}updateNavbar(){const n=E.isAuthenticated(),e=document.querySelector(".nav-menu"),t=E.getUserInfo();e.innerHTML=n&&t?`\n        <li><a href="#/home" class="nav-link">Home</a></li>\n        <li><a href="#/add" class="nav-link">Add Story</a></li>\n        <li class="user-menu">\n          <span class="user-name">Hello, ${t.name}</span>\n          <button class="btn btn-secondary btn-small" onclick="window.app.logout()">Logout</button>\n        </li>\n      `:'\n        <li><a href="#/home" class="nav-link">Home</a></li>\n        <li><a href="#/login" class="nav-link">Login</a></li>\n        <li><a href="#/register" class="nav-link">Register</a></li>\n      '}updateActiveNavLink(){const n=this.router.getCurrentRoute();document.querySelectorAll(".nav-link").forEach((e=>{e.getAttribute("href")===`#${n}`?(e.classList.add("active"),e.setAttribute("aria-current","page")):(e.classList.remove("active"),e.removeAttribute("aria-current"))}))}renderHome(){this.destroyCurrentView(),this.currentView=new M,this.currentView.render()}renderAddStory(){E.isAuthenticated()?(this.destroyCurrentView(),this.currentView=new C(this.router),this.currentView.render()):this.router.navigate("/login")}renderLogin(){E.isAuthenticated()?this.router.navigate("/home"):(this.destroyCurrentView(),this.currentView=new z(this.router),this.currentView.render())}renderRegister(){E.isAuthenticated()?this.router.navigate("/home"):(this.destroyCurrentView(),this.currentView=new N(this.router),this.currentView.render())}logout(){E.logout(),this.updateNavbar(),this.router.navigate("/login")}destroyCurrentView(){this.currentView&&"function"==typeof this.currentView.destroy&&(this.currentView.destroy(),this.currentView=null)}}document.addEventListener("DOMContentLoaded",(()=>{console.log("App initializing..."),window.app=new P})),window.addEventListener("beforeunload",(()=>{document.querySelectorAll("video").forEach((n=>{n.srcObject&&n.srcObject.getTracks().forEach((n=>n.stop()))}))}))})();